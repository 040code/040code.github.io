<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"/><style data-href="/styles.131b48b25a50eff60b34.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.22.9"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><style data-styled="hTmxqc lcZENV lfoWPa hPmQYh dANmgz brBAvj hpDnww bWPqAN hwkicN iTdcdb jRHVYT kQWgFX itRnbT jNHeyA hFicPH" data-styled-version="4.3.2">
/* sc-component-id: SideMenu__StyledBurgerMenu-uekpe8-0 */
.hTmxqc .bm-burger-button{position:fixed;width:36px;height:30px;left:36px;top:36px;} .hTmxqc .bm-burger-bars{background:#ffffff;} .hTmxqc .bm-cross-button{height:24px;width:24px;} .hTmxqc .bm-cross{background:#ffffff;} .hTmxqc .bm-menu{background:rgb(0,0,0,0.5);padding:2.5em 1em 0;font-size:1.15em;} .hTmxqc .bm-morph-shape{fill:#373a47;} .hTmxqc .bm-item-list{padding-top:2em;} .hTmxqc .bm-item{display:inline-block;padding:0.5em;} .hTmxqc .bm-overlay{background:rgba(0,0,0,0.3);}
/* sc-component-id: SideMenu__MenuLink-uekpe8-1 */
.lcZENV{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#fff;border:0;margin:0;margin-right:0.5rem;padding-left:20px;padding-right:20px;min-width:42px;z-index:10;}
/* sc-component-id: Footer__FooterWrapper-sc-1oxe0wr-0 */
.hFicPH{text-align:left;padding-top:30px;padding-bottom:50px;background-color:rgba(32,35,42,0.85);color:#ffffff;padding-left:20px;padding-right:20px;margin:3.5em auto 0 0;} .hFicPH nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;max-width:900px;margin:0 auto;} .hFicPH nav .footer-col{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-bottom:1em;padding-right:1em;} .hFicPH a{color:#ffffff;font-weight:bold;} .hFicPH a:hover{color:#e8e8e8;border-bottom:1px dotted #e8e8e8;} .hFicPH .footer-col > p{margin:0;} .hFicPH .footer-title{margin:0 0 1rem;} .hFicPH .footer-item{padding:0.25rem 0;color:#ffffff;} .hFicPH .footer-heart{color:red;} .hFicPH .footer-item-text{padding:0.1rem 0;color:#ffffff;} .hFicPH .footer-header{-webkit-order:1;-ms-flex-order:1;order:1;margin:0 0.25rem;margin-right:0.25rem;padding:0.25rem;} @media (max-width:564px){.hFicPH .footer-col:first-child{width:100%;}}
/* sc-component-id: sc-global-693195232 */
*{box-sizing:border-box;margin:0;padding:0;} body{font-family:"Lato",sans-serif;color:#222222cc;background-color:#e8e8e8;} img{max-width:100%;height:auto;vertical-align:middle;border:0;} a{-webkit-text-decoration:none;text-decoration:none;color:#0366d6;} ul,ol{padding-left:2em;margin:1em 0 0 0;}
/* sc-component-id: Wrapper-aej7i5-0 */
.hwkicN{position:relative;border-radius:3px;width:80%;max-width:770px;border-bottom:1px solid #ebf2f6;word-wrap:break-word;background-color:#fff;margin:0px auto 30px auto;top:30px;padding:50px;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);} @media (max-width:780px){.hwkicN{width:90%;padding:25px;}}
/* sc-component-id: TagList__ListContainer-sc-1uj42o2-0 */
.kQWgFX{display:inline;margin:0 0.5rem 0 0;color:#787676;}
/* sc-component-id: TagList__TagListItem-sc-1uj42o2-1 */
.itRnbT{margin-left:0.3rem;display:inline-block;min-width:10px;padding:3px 7px;font-size:12px;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:middle;background-color:#777;border-radius:10px;} .itRnbT:hover{border-bottom:1px dotted #787676;}
/* sc-component-id: ContentHeader__Header-sc-1uw779c-0 */
.jRHVYT{margin-bottom:2rem;color:#787676;}
/* sc-component-id: Content__ContentBody-sc-1jppj8x-0 */
.jNHeyA{line-height:1.6;} .jNHeyA > *:first-child{padding-top:0;margin-top:0;} .jNHeyA > h1{margin-top:3rem;font-size:2em;} .jNHeyA > h2{margin-top:3rem;font-size:1.5em;} .jNHeyA > h3{padding-top:3rem;font-size:1.17em;} .jNHeyA > p{margin:1em 0 0 0;} .jNHeyA a{border-bottom:1px dotted rgba(162,162,162,0.8);} .jNHeyA a:hover{border-bottom-style:solid;} .jNHeyA a.anchor,.jNHeyA a.gatsby-resp-image-link{border:none;} .jNHeyA > blockquote{box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:0.4em solid rgba(32,35,42,0.85);} .jNHeyA > blockquote p{margin:0.8em 0;font-style:italic;} .jNHeyA .gatsby-highlight{border-radius:5px;font-size:15px;line-height:1.7;background:#2d2d2d;color:#ffffff;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em 0em 1.5em 0;font-size:0.7em;} .jNHeyA .gatsby-highlight > pre{border:0;margin:0;padding:1;} .jNHeyA .gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #ffa7c4;} .jNHeyA p > code.language-text,.jNHeyA li > code.language-text{background:rgba(255,229,100,0.2);color:#222222cc;padding:0 3px;font-size:0.94em;border-radius:0.3rem;} .jNHeyA table{margin-top:1em;border-collapse:collapse;border-radius:0.5em;overflow:hidden;} .jNHeyA table th,.jNHeyA table td{padding:0.5em;background:#e8e8e8;border-bottom:2px solid white;} .jNHeyA:not(pre) a code[class*='language-']{color:#222222cc;background-color:rgba(255,229,100,0.2);}
/* sc-component-id: Hero__HeroContainer-sc-1i1rqpz-0 */
.lfoWPa{position:relative;display:table;width:100%;height:340px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:cover;}
/* sc-component-id: Hero__TitleContainer-sc-1i1rqpz-1 */
.hPmQYh{display:table-cell;vertical-align:middle;text-align:center;width:100%;}
/* sc-component-id: Hero__HeroTitle-sc-1i1rqpz-3 */
.dANmgz{font-size:3.5rem;margin:10px 60px;color:#fff;text-shadow:2px 2px #222222;font-weight:800;font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif;}
/* sc-component-id: Hero__HeroSubtitle-sc-1i1rqpz-4 */
.brBAvj{font-size:1.7rem;margin:10px 60px;color:#fff;text-shadow:2px 2px #222222;font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif;}
/* sc-component-id: Hero__DateAndAuthor-sc-1i1rqpz-5 */
.hpDnww{font-weight:500;font-size:1.2rem;color:#fff;text-shadow:2px 2px #222222;}
/* sc-component-id: Hero__AuthorLink-sc-1i1rqpz-6 */
.bWPqAN{margin-left:0.3rem;font-weight:500;font-size:1.2rem;color:#fff;text-shadow:2px 2px #222222;} .bWPqAN:hover{border-bottom:1px dotted #787676;} .bWPqAN:before{content:'@';}
/* sc-component-id: Article__ArticleWrapper-sc-1nyoqfc-0 */
.iTdcdb{padding:0 30px 30px;} @media only screen and (max-width:500px){.iTdcdb{padding:0;}}</style><title data-react-helmet="true">Getting Help From Your Compiler | 040code</title><link data-react-helmet="true" rel="stylesheet" type="text/css" href="/asciinema-player.css"/><link data-react-helmet="true" rel="canonical" href="https://040code.github.io/2020/05/25/getting-help-from-your-compiler"/><meta data-react-helmet="true" name="description" content="I’m learning about functional programming. I’m having loads of fun doing that,
but I also think my code is improving because of it. In this…"/><meta data-react-helmet="true" property="og:url" content="https://040code.github.io/2020/05/25/getting-help-from-your-compiler"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Getting Help From Your Compiler | 040code"/><meta data-react-helmet="true" property="og:description" content="I’m learning about functional programming. I’m having loads of fun doing that,
but I also think my code is improving because of it. In this…"/><meta data-react-helmet="true" property="og:image" content="https://040code.github.io/static/79021e18f6a7cb67941f7dff67465808/cover.jpeg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="niekos77"/><meta data-react-helmet="true" name="twitter:title" content="Getting Help From Your Compiler | 040code"/><meta data-react-helmet="true" name="twitter:description" content="I’m learning about functional programming. I’m having loads of fun doing that,
but I also think my code is improving because of it. In this…"/><meta data-react-helmet="true" name="twitter:image" content="https://040code.github.io/static/79021e18f6a7cb67941f7dff67465808/cover.jpeg"/><script data-react-helmet="true" src="/asciinema-player.js"></script><link rel="icon" href="/favicon-32x32.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link as="script" rel="preload" href="/6dae301c9709e8c5899acc3516b7dd8f43382179-3a8e428404b3ed412f4e.js"/><link as="script" rel="preload" href="/framework-d9760d5f29a556096c12.js"/><link as="script" rel="preload" href="/app-2e259087cf0f884cb471.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-8ba9e14f49a230982ddd.js"/><link as="script" rel="preload" href="/6b89ea6005f9c555c01b9da0decab7e9d6623b3d-acf9dd694899c0988cea.js"/><link as="script" rel="preload" href="/777cf710-f81af635b8297329d6d2.js"/><link as="script" rel="preload" href="/styles-503b3015a8b38c118cb7.js"/><link as="script" rel="preload" href="/webpack-runtime-88371d95a4ecc8f25203.js"/><link as="fetch" rel="preload" href="/page-data/2020/05/25/getting-help-from-your-compiler/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript>This site runs best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="SideMenu__StyledBurgerMenu-uekpe8-0 hTmxqc"><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/">🏡 040 blog</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/about">About</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/niek">Niek Palm</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/maarten">Maarten Metz</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/jeroen">Jeroen Knoops</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/stefan">Stefan van den Oord</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/thales">Thales Sousa</a></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><span style="position:absolute;top:6px;right:14px"><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(45deg)"></span><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(-45deg)"></span></span><button style="position:absolute;left:0;top:0;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button></div></div></div><div><div class="bm-burger-button" style="z-index:1000"><span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:0%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:40%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:80%;opacity:1"></span></span><button style="position:absolute;left:0;top:0;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button></div></div></div></div><div style="margin:0 0"><div style="background-image:url(&quot;/static/79021e18f6a7cb67941f7dff67465808/cover.jpeg&quot;)" class="Hero__HeroContainer-sc-1i1rqpz-0 lfoWPa"><div class="Hero__TitleContainer-sc-1i1rqpz-1 hPmQYh"><h1 class="Hero__HeroTitle-sc-1i1rqpz-3 dANmgz">Getting Help From Your Compiler</h1><h2 class="Hero__HeroSubtitle-sc-1i1rqpz-4 brBAvj">Using clever data types to reduce the possibilities for mistakes</h2><span class="Hero__DateAndAuthor-sc-1i1rqpz-5 hpDnww">by:<!-- --> <a class="Hero__AuthorLink-sc-1i1rqpz-6 bWPqAN" href="/authors/stefan">stefan</a>  on <!-- -->2020-05-25</span></div></div><main role="main" class="Wrapper-aej7i5-0 hwkicN"><article class="Article__ArticleWrapper-sc-1nyoqfc-0 iTdcdb"><section><header class="ContentHeader__Header-sc-1uw779c-0 jRHVYT"><div class="TagList__ListContainer-sc-1uj42o2-0 kQWgFX"><a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/functional">functional</a> <a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/typescript">typescript</a> <a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/either">either</a> <a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/validation">validation</a> <a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/react">react</a></div></header><div class="Content__ContentBody-sc-1jppj8x-0 jNHeyA"><p><em>I’m learning about functional programming. I’m having loads of fun doing that,
but I also think my code is improving because of it. In this post I want to
share something that I learned about using Either to do form validation in
TypeScript.</em></p>
<p style="text-align: right">
  <a href="https://github.com/svdo/either-validation-demo" target="sourcecode">
  <i class="fab fa-github" style="font-size: 200%">&nbsp;</i>Source code for this post</a></p>
<h2 id="contents" style="position:relative;"><a href="#contents" aria-label="contents permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contents</h2>
<ul>
<li><a href="#the-case-for-non-breaking-switches">The Case for Non-Breaking Switches</a></li>
<li><a href="#clever-data-types-can-help-too">Clever Data Types can Help Too</a></li>
<li><a href="#the-scary-bit-">The Scary Bit 😱</a></li>
<li><a href="#using-this-in-the-ui">Using This In The UI</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#a-new-vocabulary">A New Vocabulary</a></li>
<li><a href="#appendix-lift-and-lift2">Appendix: lift and lift2</a></li>
<li><a href="#making-the-validation-functions-reusable">Making the validation functions reusable</a></li>
</ul>
<p><strong>[Update June 4, 2020]</strong> When continuing to work on this code, I improved one
important aspect. At the end of this post I added the section <a href="#making-the-validation-functions-reusable">Making the
validation functions reusable</a> to
explain. Also the code in the <a href="https://github.com/svdo/either-validation-demo">github repo</a> was updated to reflect
this.</p>
<h2 id="the-case-for-non-breaking-switches" style="position:relative;"><a href="#the-case-for-non-breaking-switches" aria-label="the case for non breaking switches permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Case for Non-Breaking Switches</h2>
<p>Some (well, many I guess) programming languages have a construct called a
<code class="language-text">switch</code> statement. It usually looks something like this (in JavaScript):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">commentOnDinnerPreference</span> <span class="token operator">=</span> <span class="token parameter">pref</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reply <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>pref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'broccoli'</span><span class="token operator">:</span>
      reply <span class="token operator">=</span> <span class="token string">'yes, very healthy'</span>

    <span class="token keyword">case</span> <span class="token string">'pizza hawaii'</span><span class="token operator">:</span>
      reply <span class="token operator">=</span> <span class="token string">'who does not like carbs and fat?'</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>There’s a few things that are fishy (pun intended) about this piece of code. For
one, it doesn’t say what should be done when a specific dinner preference is not
addressed in the <code class="language-text">switch</code> statement. You could do that by either exhaustively
listing all possible dinner preferences, or by adding a <code class="language-text">default</code> case. Another
issue is that the <code class="language-text">break</code> statements are missing. So when the dinner preference
is “broccoli”, the reply will still be “who doesn’t like carbs and fat?”, which
is probably not what you intended. My editor (VS Code) and my compiler/packager
are perfectly happy with this JavaScript code.</p>
<p>So Typescript maybe? Let’s see:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">enum</span> DinnerPreference <span class="token punctuation">{</span>
  Broccoli<span class="token punctuation">,</span>
  PizzaHawaii<span class="token punctuation">,</span>
  Fries
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">commentOnDinnerPreference</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pref<span class="token operator">:</span> DinnerPreference</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reply <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>pref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> DinnerPreference<span class="token punctuation">.</span>Broccoli<span class="token operator">:</span>
      reply <span class="token operator">=</span> <span class="token string">'yes, very healthy'</span>
      <span class="token keyword">break</span>

    <span class="token keyword">case</span> DinnerPreference<span class="token punctuation">.</span>PizzaHawaii<span class="token operator">:</span>
      reply <span class="token operator">=</span> <span class="token string">'who does not like carbs and fat?'</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Here I actually did get warnings about the missing <code class="language-text">break</code> statements from the
linter. But the switch still is not exhaustive and there’s no feedback on that.</p>
<p>When I do this in Swift for example, it’s a lot harder to do this wrong. First,
there are no <code class="language-text">break</code> statements in Swift, there is no implicit fall-through. In
other words: a matching case automatically “exits” the switch, if you want
fall-through you have to make <em>that</em> explicit. But it gets better: the compiler
gives an <em>error</em> “switch must be exhaustive” and offers to automatically add
statements for missing cases. That’s a helpful compiler for you, it reduces the
number of mistakes that you can make!</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVQoz22S3VKDMBSEeZlaAiQhpAmUUBGttKPO1OmFV977/k+wboL1/+KbE8LJzu5JsunmCc3hDDM/Q7cjitIgFxqiqP/l+7+4ruQGum6htE81e3J7qHCPimIiiuUqNSZyvXwn9KfY9/pHUFQWgpt5yQYKCmlREkkqRfRmgeviH7cXQX0R9NtbuOkINywUNqD2Ozg/wHQDbD/ChhGmHSCqBld0u6ZQJK4LGlIUkhSMLrNHO2LqrhF4oCkMFJtkLomCFiRfiPuWCRydWrrfqAWnHfFoKeqjw4O/wzQ/YJju4I1PTcE4WNbLrIqPeG9th9f5iNN+xnl/wMvxEadpjyOT3Lc9RR2yLSOGacZ2oNN+h46bPQVj9ZxdxJEYcSdrBLdF3wb0vicBY7jBtLuFbzrUdJtJFYfpITmfkodKXk5JRxWrZMRIFS+Leyv+XzH61Vql+a3Wki+j4YW5ZYYxstEDWs7Q2C415Sle/fV0hP4R/fe7lGqD2nTJVLzld54QHHaY4NxPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/f1da60fa8f5ea4406cb36c3bc47a4da4/cbe2e/swift-switch.webp 148w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/3084c/swift-switch.webp 295w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/5ca24/swift-switch.webp 590w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/dad35/swift-switch.webp 885w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/2baf0/swift-switch.webp 1180w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/52977/swift-switch.webp 1390w"
          sizes="(max-width: 590px) 100vw, 590px"
          type="image/webp"
        />
        <source
          srcset="/static/f1da60fa8f5ea4406cb36c3bc47a4da4/12f09/swift-switch.png 148w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/e4a3f/swift-switch.png 295w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/fcda8/swift-switch.png 590w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/efc66/swift-switch.png 885w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/c83ae/swift-switch.png 1180w,
/static/f1da60fa8f5ea4406cb36c3bc47a4da4/f1c64/swift-switch.png 1390w"
          sizes="(max-width: 590px) 100vw, 590px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/f1da60fa8f5ea4406cb36c3bc47a4da4/fcda8/swift-switch.png"
          alt="Swift gives a compiler error"
          title="Swift gives a compiler error"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span></p>
<h2 id="clever-data-types-can-help-too" style="position:relative;"><a href="#clever-data-types-can-help-too" aria-label="clever data types can help too permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clever Data Types can Help Too</h2>
<p>Let’s think a bit about <em>validation</em> for a moment. For example, you’re writing a
GUI that contains a form, and you need to validate the elements of that form.
Making it even more specific: a registration web page where a user can sign up
for a new account by providing information like e-mail, phone number, and a
password (twice, to prevent typing mistakes).</p>
<p>This kind of code can easily become a big mess of conditional logic: <strong>if</strong> the
e-mail field is not empty <strong>and</strong> it is not a valid e-mail address, <strong>then</strong>
show an error. And <strong>if</strong> the phone number field is not empty <strong>and</strong> it is not
a valid phone number, <strong>then</strong> show another error. And <strong>if</strong> the password is
not empty <strong>and</strong> does not meet the minimum requirements, <strong>then</strong> show yet
another error. And <strong>if</strong> any of the above <strong>if</strong>s were true, <strong>then</strong> disable
the submit button. And so on. Yes, you can write that code, but it’s going to be
ever so easy to forget cases and combinations of cases.</p>
<p>So why not use a cleverly designed data type? I’m not making this up myself,
smarter people have already done so, and they call the type <code class="language-text">Either</code>. Typically
it represents <em>either</em> an error <em>or</em> a valid value. The error case is (by
convention) called the <em>left</em> of the <code class="language-text">Either</code>, the valid value is the <em>right</em>.
So a variable of the <code class="language-text">Either</code> type could either be <code class="language-text">left(&#39;that e-mail address is
invalid&#39;)</code> or it could be <code class="language-text">right(&#39;me@example.com&#39;)</code>.</p>
<p>This data type comes with an API. This API is designed in such a way that it
becomes hard to “do the wrong thing”. For example, the function that allows you
to get the valid value out of the <code class="language-text">Either</code> if it’s a <code class="language-text">right</code>, <em>requires</em> you to
also specify what should happen when it’s a <code class="language-text">left</code>. You can’t forget, because it
won’t compile<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.</p>
<p>So how do you use that? Back to our registration page, let’s define the
following validation function (in TypeScript):</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> emailValid <span class="token operator">=</span> <span class="token punctuation">(</span>email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>    <span class="token comment">// (1)</span>
  emailAddress<span class="token punctuation">.</span><span class="token function">parseOneAddress</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span>                   <span class="token comment">// (2)</span>
    <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>                                               <span class="token comment">// (3)</span>
    <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'invalid email address'</span><span class="token punctuation">)</span>                              <span class="token comment">// (4)</span></code></pre></div>
<p>On line <code class="language-text">(1)</code>, you see the declaration of the validation function. It’s argument
is that string that we want to validate, and the return type is an <code class="language-text">Either</code> of
which both the left hand side and the right hand side are a <code class="language-text">string</code>. That’s
because the error (left) is a string, and the valid value, namely the email
address, is also a string. On line <code class="language-text">(2)</code> we call a library function to parse the
provided string and check whether the return value is <code class="language-text">null</code>. When it’s not, the
email address was valid and we return the right on line <code class="language-text">(3)</code>, or when it is
<code class="language-text">null</code> then we return the left on line <code class="language-text">(4)</code>. Nice and simple.</p>
<p>Let’s define a few more.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> phoneValid <span class="token operator">=</span> <span class="token punctuation">(</span>phone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token regex">/[0-9]{10}/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'invalid phone number'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> equalPasswords <span class="token operator">=</span> <span class="token punctuation">(</span>
  p1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  p2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">(</span>p1 <span class="token operator">===</span> p2 <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'passwords differ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> minLength <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  s<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'password must be at least 8 characters'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> oneCapital <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token regex">/[A-Z]/g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'password must have at least one capital'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> oneNumber <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token regex">/[0-9]/g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'password must have at least one number'</span><span class="token punctuation">)</span></code></pre></div>
<p>Zooming in on the password, we note that there’s a bunch of different ways in
which a password can be wrong, and we want to capture all of them. So we want to
call all of the related password-checking functions, each of which will give an
<code class="language-text">Either</code> as a result, and then <em>combine</em> those <code class="language-text">Either</code>s. Combining the <code class="language-text">right</code>
is easy. After all, if it’s a <code class="language-text">right</code> then the right contains the password, so
the combined either should still have the password as a value. How do we combine
the left? By converting the left from a string to an array of strings, and then
concatenating those arrays. This conversion is called <em>lifting</em>: we lift the
single error string into an array containing that single error string. And now
that the lefts are lifted into arrays, we can combine them by concatenating
those arrays. If you’re interested in the source code of <code class="language-text">lift</code>, you can find it
in the appendix below, but for now it’s good enough if you conceptually
understand what it does: it converts <code class="language-text">left(&#39;passwords differ&#39;)</code> into
<code class="language-text">left([&#39;passwords differ&#39;])</code>, for example.</p>
<h2 id="the-scary-bit-" style="position:relative;"><a href="#the-scary-bit-" aria-label="the scary bit  permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Scary Bit 😱</h2>
<p>The library that I’ve been using for this style of (functional) programming in
TypeScript, is <a href="https://gcanti.github.io/fp-ts">fp-ts</a>. It has some concepts that may seem scary if
you’ve never seen them before. But fear not, it’s actually not that difficult to
understand and use.</p>
<p>First up: <a href="https://dev.to/gcanti/getting-started-with-fp-ts-semigroup-2mf7">semigroup</a>. A semigroup is just something that supports
<em>combining</em> things. Or <code class="language-text">concat</code>ing if you like. You can see why we need this,
right? We need to combine the error strings in the <code class="language-text">left</code>s of all the validation
results.</p>
<p>Then there’s the function <code class="language-text">getValidation()</code>, which returns a special kind of
<code class="language-text">Either</code> that knows that the <code class="language-text">left</code>s have to be combined somehow. How, you ask?
That’s defined by the <em>semigroup</em> that you give it.</p>
<div style="text-align: center; font-size: 3em;">🤯</div>
<p>Ok ok, relax, you’ll get there. The following piece of code just means: give me
a special <code class="language-text">Validation</code>-kind of an <code class="language-text">Either</code> that knows how to combine <code class="language-text">lefts</code> by
concatenating the string arrays that they contain:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> getValidation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getSemigroup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/NonEmptyArray'</span>

<span class="token keyword">const</span> <span class="token function-variable function">applicativeValidation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getValidation</span><span class="token punctuation">(</span>getSemigroup<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>If you want more details / explanation, I recommend reading their
<a href="https://dev.to/gcanti/getting-started-with-fp-ts-either-vs-validation-5eja">article</a> about the topic.</p>
<p>The last scary piece of the puzzle consists of <code class="language-text">sequenceS</code> and <code class="language-text">sequenceT</code>. They
are basically the same, so let’s start with <code class="language-text">sequenceT</code> (<code class="language-text">T</code> is for tuple, aka
array). It needs the <code class="language-text">applicativeValidation</code> we just defined, and then a list of
our validation functions. It spits out an array of the return values of the
validation functions. Well, sort of. It puts it in an <code class="language-text">Either</code> first. That is,
unless one or more of those <code class="language-text">Either</code>s was a left, in that case <code class="language-text">sequenceT</code> spits
the left which is the array of errors that the applicative validation has
created.</p>
<p>“Example!” you shout in desperation? Sure thing:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token function">sequenceT</span><span class="token punctuation">(</span><span class="token function">applicativeValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>         <span class="token comment">// (1)</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>minLength<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token comment">// (2)</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>oneCapital<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>                 <span class="token comment">// (3)</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>oneNumber<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token comment">// (4)</span>
      <span class="token function">lift2</span><span class="token punctuation">(</span>equalPasswords<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>         <span class="token comment">// (5)</span>
    <span class="token punctuation">)</span></code></pre></div>
<p>This uses the simple validation functions that we defined above, as well as
<code class="language-text">lift</code> which we already mentioned, and <code class="language-text">lift2</code> which is the same thing but then
to lift a validation function that takes two parameters instead of just
one.<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> It returns an <code class="language-text">Either</code>. When everything is ok, it returns:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>p1<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>One <code class="language-text">p1</code> because the return value of line <code class="language-text">(2)</code> is
<code class="language-text">right(p1)</code>, one because line <code class="language-text">(3)</code> returns <code class="language-text">right(p1)</code>, one for line <code class="language-text">(4)</code> and
one for line <code class="language-text">(5)</code> (because <code class="language-text">equalPasswords</code> also returns <code class="language-text">p1</code> when all was ok).
However, if one or more of those return values was a <code class="language-text">left</code>, the whole thing is
a <code class="language-text">left</code>. For example when the passwords don’t have a number or an upper case
character, the return value is:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'password must have at least one capital'</span><span class="token punctuation">,</span>
      <span class="token string">'password must have at least one number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>In order to use this as a building block for the entire form validation, we want
a <code class="language-text">passwordValid</code> function that returns only <code class="language-text">right(p1)</code>, not the array of four
<code class="language-text">p1</code>s, so we <code class="language-text">map</code> the <code class="language-text">Either</code> and get the following password validation
function.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/pipeable'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> constant <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/function'</span>

<span class="token keyword">function</span> <span class="token function">passwordValid</span> <span class="token punctuation">(</span>
  <span class="token parameter">p1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  p2<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span>NonEmptyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">sequenceT</span><span class="token punctuation">(</span><span class="token function">applicativeValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>minLength<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>oneCapital<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">lift</span><span class="token punctuation">(</span>oneNumber<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">lift2</span><span class="token punctuation">(</span>equalPasswords<span class="token punctuation">)</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">constant</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This <code class="language-text">map</code> conceptually is the same as the one you already know for arrays: it
takes whatever value is captured (the things in the array, or the right-hand
side of the either), and applies a function to it. The <code class="language-text">pipe</code> function pipes the
value of an expression into a pipeline of functions. See
<a href="https://gcanti.github.io/fp-ts/modules/pipeable.ts.html#pipe">example</a>. The function <code class="language-text">constant</code> is a function that always
returns the given value. This is needed because <code class="language-text">map</code> requires a <em>function</em> to
be applied to the element (the <code class="language-text">right</code> in this case). Instead of <code class="language-text">constant(p1)</code>
we could also write <code class="language-text">() =&gt; p1</code>, but this way the intention is more explicit.</p>
<p>Now it’s a small step to define the entire form validation function. In this
case we use <code class="language-text">sequenceS</code> instead of <code class="language-text">sequenceT</code>. Where <code class="language-text">sequenceT</code> makes an array
of elements in the <code class="language-text">right</code>, <code class="language-text">sequenceS</code> makes an object:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateRegistrationData</span> <span class="token punctuation">(</span>
  <span class="token parameter">email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  p1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  p2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  consent<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span>NonEmptyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span> RegistrationData<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sequenceS</span><span class="token punctuation">(</span><span class="token function">applicativeValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    email<span class="token operator">:</span> <span class="token function">lift</span><span class="token punctuation">(</span>emailValid<span class="token punctuation">)</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">,</span>
    phone<span class="token operator">:</span> <span class="token function">lift</span><span class="token punctuation">(</span>phoneValid<span class="token punctuation">)</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token function">passwordValid</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Look at that! We have a function that takes all the individual form input
values, and it spits out an object that happens to be my internal user-profile
representation, or a list of errors!</p>
<div style="text-align: center; font-size: 3em;">😎</div>
<h2 id="using-this-in-the-ui" style="position:relative;"><a href="#using-this-in-the-ui" aria-label="using this in the ui permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using This In The UI</h2>
<p>For the UI part I’ll be using React. Because of it’s declarative nature it
matches very well with the above function style of doing validation. The
component that we are creating is called <code class="language-text">RegistrationForm</code>. It uses a bunch of
state hooks for the individual form input values:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">RegistrationForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>phone<span class="token punctuation">,</span> setPhone<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>password1<span class="token punctuation">,</span> setPassword1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>password2<span class="token punctuation">,</span> setPassword2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Field</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">Email:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>email<span class="token punctuation">}</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setEmail</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Field</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Field</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">Phone:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mobile<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>phone<span class="token punctuation">}</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPhone</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Field</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Input</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Password<span class="token punctuation">'</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>password1<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPassword1</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Input</span></span>
          <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Password again<span class="token punctuation">'</span></span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>password2<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPassword2</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">primary</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Register<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>Easy enough. Now for the interesting part. After declaring the variables for the
various state hooks, we add the call to our validation function. You don’t need
to put the type there, TypeScript will infer it for you, but I did so anyway to
remind you of what our validation function is returning.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">  <span class="token keyword">const</span> validationResult<span class="token operator">:</span> Either<span class="token operator">&lt;</span>
    NonEmptyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span>
    RegistrationData
  <span class="token operator">></span> <span class="token operator">=</span> <span class="token function">validateRegistrationData</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> password1<span class="token punctuation">,</span> password2<span class="token punctuation">)</span></code></pre></div>
<p>In Semantic UI, the <code class="language-text">Form</code> element has to know whether there’s an error in the
form. That’s easy, we use the <code class="language-text">isLeft</code> API function of <code class="language-text">Either</code>. So we replace
the <code class="language-text">&lt;Form&gt;</code> element with:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> isLeft <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span>

<span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>

 <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span> <span class="token attr-name">error</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">isLeft</span><span class="token punctuation">(</span>validationResult<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">

   [...]</span></code></pre></div>
<p>Nice, no conditionals yet. We can use that same construct to enable/disable the
submit button:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">primary</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Register<span class="token punctuation">'</span></span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">isLeft</span><span class="token punctuation">(</span>validationResult<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>What should happen when we click the ‘Register’ button? In my case, since I’m
also using Redux, it should dispatch an action that takes the <code class="language-text">RegistrationData</code>
as a parameter. We can do that using <code class="language-text">map</code> again. On an <code class="language-text">Either</code>, map performs a
function on value if it’s a <code class="language-text">right</code>, and leaves it alone if it’s a <code class="language-text">left</code>.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span>

<span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">primary</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Register<span class="token punctuation">'</span></span>
          <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">isLeft</span><span class="token punctuation">(</span>validationResult<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reg<span class="token operator">:</span> RegistrationData</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">startRegistration</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>validationResult<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span></code></pre></div>
<p>The final piece of the puzzle is the list of error messages. To show that, we
want to <code class="language-text">swap</code> the <code class="language-text">Either</code>, meaning that it replaces left and right. That’s
because we want to do something with the errors which are left, but “doing
something with an Either” mostly means doing it on a <code class="language-text">right</code>. Also, we use
<code class="language-text">getOrElse</code>, which is one of those safe API methods that I mentioned. Not only
does it return the <code class="language-text">right</code> of an <code class="language-text">Either</code>, but also do you need to specify what
has to happen when the <code class="language-text">Either</code> was a <code class="language-text">left</code>. Here we simply generate an empty
array in case of a left, and we have to make the TypeScript compiler happy by
saying what type that empty array has.</p>
<p>So we get the array of error message out of the Either and pass it into a
Semantic UI <code class="language-text">Message</code> element like this:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span></span>
          <span class="token attr-name">error</span>
          <span class="token attr-name">header</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">t</span><span class="token punctuation">(</span>
            <span class="token string">'registration.formErrors'</span><span class="token punctuation">,</span>
            <span class="token string">'Het formulier is niet goed ingevuld'</span>
          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">list</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">swap</span><span class="token punctuation">(</span>validationResult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span></code></pre></div>
<div style="text-align: center; font-size: 3em;">🥳</div>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>Do you realize what we just did? We created an entry form with input validation.
It shows a full list of errors all the time, and updates it <em>as you type</em>. And
we did so <strong>without using a single conditional</strong> outside of the individual
simple validation functions like <code class="language-text">oneCapital</code>, which is where they belong. And
as a bonus all those simple validation functions are super-easy to unit-test and
highly reusable. The other conditionals that you would normally need are now
abstracted away in the <code class="language-text">Either</code> and <code class="language-text">Validation</code>, so that you can’t do it wrong
anymore. I don’t know about you, but I’m happy. 😀</p>
<p>The full source code and a completely working example can be found on
<a href="https://github.com/svdo/either-validation-demo">github</a>. As a bonus, it also contains a couple of Jest matchers for
checking Eithers in unit tests.</p>
<h2 id="a-new-vocabulary" style="position:relative;"><a href="#a-new-vocabulary" aria-label="a new vocabulary permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A New Vocabulary</h2>
<p>There is one last observation that I’d like to make. All your “C-style”
programming languages are basically the same. A loop (for, while), a condition,
some stuff about objects classes, a switch. When you can write Java, you can
also write Swift or C#. Sure, you need to learn some new APIs, but the basic
building blocks are all the same. It’s a common vocabulary shared by all these
languages, that allow you to talk and reason about code.</p>
<p>As I challenge myself to use the functional programming concepts more and more,
like I did in this article, I find that it gives me a whole new vocabulary in a
similar way, but on a higher abstraction level. Learn how to use <code class="language-text">fp-ts</code> in
TypeScript, and you use the same constructs in Haskell, PureScript, Scala, etc.
So any investment that you make in learning this stuff is not limited to the
specific programming language that you learn it for. And it’s going to allow you
to write your code using higher-level abstractions, thereby reducing hopefully
the number of bugs.</p>
<h2 id="appendix-lift-and-lift2" style="position:relative;"><a href="#appendix-lift-and-lift2" aria-label="appendix lift and lift2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Appendix: lift and lift2</h2>
<p>As promised, below are the definitions for <code class="language-text">lift</code> and <code class="language-text">lift2</code>. The actual code
is quite simple. When you pass a validation function into it (called <code class="language-text">check</code>
here), this returns a new function that, when called, first calls the original
validation function and then uses <code class="language-text">mapLeft</code> to put the <code class="language-text">left</code> value in an array.
It ignores <code class="language-text">right</code> values. All the type stuff around it may make it look a bit
daunting, but if you give it a hard stare you should probably be able to figure
it out. 🧐</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/pipeable'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Either<span class="token punctuation">,</span> mapLeft <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NonEmptyArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/NonEmptyArray'</span>

<span class="token comment">/**
 * Lifts the error of a validation function into a (non-empty) array.
 * This way multiple validation functions can be composed while appending
 * their errors to the array. This variant is for a validation function
 * with one parameter.
 *
 * lift :: ( a -> Either e,b ) -> ( a -> Either [e], b )
 *
 * @param check single-arg (validation) function of which the error is lifted
 * @see lift2
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> lift<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">></span> <span class="token punctuation">(</span>
  <span class="token function-variable function">check</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Either<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Either<span class="token operator">&lt;</span>NonEmptyArray<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">a</span> <span class="token operator">=></span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">check</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">mapLeft</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Lifts the error of a validation function into a (non-empty) array.
 * This way multiple validation functions can be composed while appending
 * their errors to the array. This variant is for a validation function
 * with two parameters.
 *
 * lift :: ( a -> b -> Either e,c ) -> ( a -> b -> Either [e], c )
 *
 * @param check double-arg (validation) function of which the error is lifted
 * @see lift
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> lift2<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">></span> <span class="token punctuation">(</span>
  <span class="token function-variable function">check</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Either<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Either<span class="token operator">&lt;</span>NonEmptyArray<span class="token operator">&lt;</span><span class="token constant">E</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">check</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">mapLeft</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="making-the-validation-functions-reusable" style="position:relative;"><a href="#making-the-validation-functions-reusable" aria-label="making the validation functions reusable permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making the validation functions reusable</h2>
<p>(This section was added on June 4, 2020)</p>
<p>There is one thing about the code above that kept bothering me. For example, take
the validation for checking that passwords contain a number:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> oneNumber <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token regex">/[0-9]/g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span>tPasswordOneNumber<span class="token punctuation">)</span></code></pre></div>
<p>The problem with this approach is that the function combines <em>two
responsibilities</em>: (1) the check whether or not the string satisfies the
conditions, and (2) attaching the proper error message when the check fails. Do
you see the problem with this? It’s not reusable. Because in another form we
maybe want to use the same check, but with a different error message. We can do
better!</p>
<p>First, we can make a completely generic and reusable check function, which even
lives in a separate more generic file:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">O</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Option'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> atLeastOneNumber <span class="token operator">=</span> <span class="token constant">O</span><span class="token punctuation">.</span><span class="token function">fromPredicate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token regex">/[0-9]/g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>This function returns an <code class="language-text">Option</code> instead of an <code class="language-text">Either</code>. An <code class="language-text">Option</code> is  either
<code class="language-text">some(value)</code>, or <code class="language-text">none</code> (which corresponds to the value being <code class="language-text">null</code> or
<code class="language-text">undefined</code>). In other words: the function <code class="language-text">atLeastOneNumber(str)</code> gives us
<code class="language-text">none</code> when the check fails, or <code class="language-text">some(str)</code> when it succeeds.</p>
<p>The second step is specific to the registration form validation, namely
attaching the proper error message. We do that by taking the output of
<code class="language-text">atLeastOneNumber</code> and putting it in an <code class="language-text">Either</code> using <code class="language-text">fromOption</code>. This API
function <code class="language-text">fromOption</code> converts the <code class="language-text">some</code> to a <code class="language-text">right</code>, and the <code class="language-text">none</code> to a
<code class="language-text">left</code> with the given value. So we get this (<code class="language-text">flow</code> is left-to-right function
composition<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>):</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> oneNumberValidator <span class="token operator">=</span> <span class="token function">flow</span><span class="token punctuation">(</span>
  atLeastOneNumber<span class="token punctuation">,</span>
  <span class="token function">fromOption</span><span class="token punctuation">(</span><span class="token function">constant</span><span class="token punctuation">(</span>tPasswordOneNumber<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>The difference becomes even more apparent with the (admittedly naive) phone
number validation. Old version:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> phoneValid <span class="token operator">=</span> <span class="token punctuation">(</span>phone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token regex">/^[0-9]{8}$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">right</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span>tInvalidPhone<span class="token punctuation">)</span></code></pre></div>
<p>New version:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">digits</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">n<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token constant">O</span><span class="token punctuation">.</span><span class="token function">fromPredicate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\^\[0-9\]\{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\}\$</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> phoneValidator <span class="token operator">=</span> <span class="token function">flow</span><span class="token punctuation">(</span>
  <span class="token function">digits</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fromOption</span><span class="token punctuation">(</span><span class="token function">constant</span><span class="token punctuation">(</span>tInvalidPhone<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>So now we have an even more generic and completely reusable <code class="language-text">digits</code> checker,
that you can pass the desired number of digits, and a specialized
<code class="language-text">phoneValidator</code> that uses it for the registration validation.</p>
<div style="text-align: center; font-size: 3em;">🎉</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>Except when you’re using JavaScript of course, <a href="https://www.destroyallsoftware.com/talks/wat">because then basically anything goes</a>.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>In TypeScript you can probably define <code class="language-text">lift</code> in such a way that it works for both single-parameter and two-parameter functions, but that’s where I draw the line for now.</p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
<li id="fn-3">
<p>So <code class="language-text">flow</code> creates a new function that is the sequential combination of the functions you put into it. The call <code class="language-text">flow(f,g)(x)</code> is equivalent to <code class="language-text">g(f(x))</code>. You can read it as “first do <code class="language-text">f</code>, then do <code class="language-text">g</code>” on whatever you pass into it.</p>
<a href="#fnref-3" class="footnote-backref">↩</a>
</li>
</ol>
</div></div></section></article></main></div><footer class="Footer__FooterWrapper-sc-1oxe0wr-0 hFicPH"><nav><div class="footer-col"><h5 class="footer-title">040 code © 2019</h5><span class="footer-item">Built with <i></i><a class="footer-link" href="https://www.gatsbyjs.org/">Gatsby</a></span></div><div class="footer-col"><h5 class="footer-title">Blog</h5><span class="footer-item"><a class="footer-link" href="/">home</a></span><span class="footer-item"><a class="footer-link" href="/about">about</a></span></div><div class="footer-col"><h5 class="footer-title">Source</h5><span class="footer-item"><i></i><a class="footer-link" href="https://github.com/040code/">Github</a></span></div></nav></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-97020149-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020/05/25/getting-help-from-your-compiler";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2e259087cf0f884cb471.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-700ae45cacd4fc163ade.js"],"component---src-pages-404-js":["/component---src-pages-404-js-60240c15c159e413014a.js"],"component---src-templates-authors-js":["/component---src-templates-authors-js-d25abe56734e460bf2b3.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-f4d4d74a632731031b6a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-8ba9e14f49a230982ddd.js"],"component---src-templates-page-js":["/component---src-templates-page-js-8586b4308cc4a2f267a8.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-1edd1605c6525b7ca700.js"]};/*]]>*/</script><script src="/webpack-runtime-88371d95a4ecc8f25203.js" async=""></script><script src="/styles-503b3015a8b38c118cb7.js" async=""></script><script src="/777cf710-f81af635b8297329d6d2.js" async=""></script><script src="/6b89ea6005f9c555c01b9da0decab7e9d6623b3d-acf9dd694899c0988cea.js" async=""></script><script src="/component---src-templates-blog-post-js-8ba9e14f49a230982ddd.js" async=""></script><script src="/app-2e259087cf0f884cb471.js" async=""></script><script src="/framework-d9760d5f29a556096c12.js" async=""></script><script src="/6dae301c9709e8c5899acc3516b7dd8f43382179-3a8e428404b3ed412f4e.js" async=""></script></body></html>