<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"/><style data-href="/styles.131b48b25a50eff60b34.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.3.35"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><style data-styled="hTmxqc lcZENV lfoWPa hPmQYh dANmgz brBAvj hpDnww bWPqAN hwkicN iTdcdb jRHVYT kQWgFX itRnbT uzIVo hFicPH" data-styled-version="4.2.0">
/* sc-component-id: SideMenu__StyledBurgerMenu-uekpe8-0 */
.hTmxqc .bm-burger-button{position:fixed;width:36px;height:30px;left:36px;top:36px;} .hTmxqc .bm-burger-bars{background:#ffffff;} .hTmxqc .bm-cross-button{height:24px;width:24px;} .hTmxqc .bm-cross{background:#ffffff;} .hTmxqc .bm-menu{background:rgb(0,0,0,0.5);padding:2.5em 1em 0;font-size:1.15em;} .hTmxqc .bm-morph-shape{fill:#373a47;} .hTmxqc .bm-item-list{padding-top:2em;} .hTmxqc .bm-item{display:inline-block;padding:0.5em;} .hTmxqc .bm-overlay{background:rgba(0,0,0,0.3);}
/* sc-component-id: SideMenu__MenuLink-uekpe8-1 */
.lcZENV{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#fff;border:0;margin:0;margin-right:0.5rem;padding-left:20px;padding-right:20px;min-width:42px;z-index:10;}
/* sc-component-id: Footer__FooterWrapper-sc-1oxe0wr-0 */
.hFicPH{text-align:left;padding-top:30px;padding-bottom:50px;background-color:rgba(32,35,42,0.85);color:#ffffff;padding-left:20px;padding-right:20px;margin:3.5em auto 0 0;} .hFicPH nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;max-width:900px;margin:0 auto;} .hFicPH nav .footer-col{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-bottom:1em;padding-right:1em;} .hFicPH a{color:#ffffff;font-weight:bold;} .hFicPH a:hover{color:#e8e8e8;border-bottom:1px dotted #e8e8e8;} .hFicPH .footer-col > p{margin:0;} .hFicPH .footer-title{margin:0 0 1rem;} .hFicPH .footer-item{padding:0.25rem 0;color:#ffffff;} .hFicPH .footer-heart{color:red;} .hFicPH .footer-item-text{padding:0.1rem 0;color:#ffffff;} .hFicPH .footer-header{-webkit-order:1;-ms-flex-order:1;order:1;margin:0 0.25rem;margin-right:0.25rem;padding:0.25rem;} @media (max-width:564px){.hFicPH .footer-col:first-child{width:100%;}}
/* sc-component-id: sc-global-3886539976 */
*{box-sizing:border-box;margin:0;padding:0;} body{font-family:"Lato",sans-serif;color:#222222cc;background-color:#e8e8e8;} img{max-width:100%;height:auto;vertical-align:middle;border:0;} a{-webkit-text-decoration:none;text-decoration:none;color:rgba(34,34,34,0.8);} ul,ol{padding-left:2em;margin:1em 0 0 0;}
/* sc-component-id: Wrapper-aej7i5-0 */
.hwkicN{position:relative;border-radius:3px;width:80%;max-width:770px;border-bottom:1px solid #ebf2f6;word-wrap:break-word;background-color:#fff;margin:0px auto 30px auto;top:30px;padding:50px;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);} @media (max-width:780px){.hwkicN{width:90%;padding:25px;}}
/* sc-component-id: Hero__HeroContainer-sc-1i1rqpz-0 */
.lfoWPa{position:relative;display:table;width:100%;height:340px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:cover;}
/* sc-component-id: Hero__TitleContainer-sc-1i1rqpz-1 */
.hPmQYh{display:table-cell;vertical-align:middle;text-align:center;width:100%;}
/* sc-component-id: Hero__HeroTitle-sc-1i1rqpz-3 */
.dANmgz{font-size:3.5rem;margin:10px 60px;color:#fff;text-shadow:2px 2px #222222;font-weight:800;font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif;}
/* sc-component-id: Hero__HeroSubtitle-sc-1i1rqpz-4 */
.brBAvj{font-size:1.7rem;margin:10px 60px;color:#fff;text-shadow:2px 2px #222222;font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif;}
/* sc-component-id: Hero__DateAndAuthor-sc-1i1rqpz-5 */
.hpDnww{font-weight:500;font-size:1.2rem;color:#fff;text-shadow:2px 2px #222222;}
/* sc-component-id: Hero__AuthorLink-sc-1i1rqpz-6 */
.bWPqAN{margin-left:0.3rem;font-weight:500;font-size:1.2rem;color:#fff;text-shadow:2px 2px #222222;} .bWPqAN:hover{border-bottom:1px dotted #787676;} .bWPqAN:before{content:'@';}
/* sc-component-id: TagList__ListContainer-sc-1uj42o2-0 */
.kQWgFX{display:inline;margin:0 0.5rem 0 0;color:#787676;}
/* sc-component-id: TagList__TagListItem-sc-1uj42o2-1 */
.itRnbT{margin-left:0.3rem;display:inline-block;min-width:10px;padding:3px 7px;font-size:12px;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:middle;background-color:#777;border-radius:10px;} .itRnbT:hover{border-bottom:1px dotted #787676;}
/* sc-component-id: ContentHeader__Header-sc-1uw779c-0 */
.jRHVYT{margin-bottom:2rem;color:#787676;}
/* sc-component-id: Content__ContentBody-sc-1jppj8x-0 */
.uzIVo{line-height:1.6;} .uzIVo > h2:first-of-type{padding-top:0;} .uzIVo > h2{padding-top:3rem;margin-top:3rem;border-top:1px solid #ececec;} .uzIVo > h3:first-of-type{padding-top:0;} .uzIVo > h3{padding-top:3rem;} .uzIVo > p{margin:1em 0 0 0;} .uzIVo a{border-bottom:1px dotted rgba(162,162,162,0.8);} .uzIVo a:hover{border-bottom-style:solid;} .uzIVo a.anchor,.uzIVo a.gatsby-resp-image-link{border:none;} .uzIVo > blockquote{box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:0.4em solid rgba(32,35,42,0.85);} .uzIVo > blockquote p{margin:0.8em 0;font-style:italic;} .uzIVo .gatsby-highlight{border-radius:5px;font-size:15px;line-height:1.7;background:#2d2d2d;color:#ffffff;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em 0em 1.5em 0;font-size:0.7em;} .uzIVo .gatsby-highlight > pre{border:0;margin:0;padding:1;} .uzIVo .gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #ffa7c4;} .uzIVo p > code.language-text,.uzIVo li > code.language-text{background:rgba(255,229,100,0.2);color:#222222cc;padding:0 3px;font-size:0.94em;border-radius:0.3rem;} .uzIVo table{margin-top:1em;border-collapse:collapse;border-radius:0.5em;overflow:hidden;} .uzIVo table th,.uzIVo table td{padding:0.5em;background:#e8e8e8;border-bottom:2px solid white;}
/* sc-component-id: Article__ArticleWrapper-sc-1nyoqfc-0 */
.iTdcdb{padding:0 30px 30px;} @media only screen and (max-width:500px){.iTdcdb{padding:0;}}</style><title data-react-helmet="true">Verlet Integration | 040code</title><link data-react-helmet="true" rel="canonical" href="https://040code.github.io/2018/03/04/verlet-integration"/><meta data-react-helmet="true" name="description" content="IntroductionIn this post we’re going to dive into physics simulation with Clojure. The
ideas in this post were mostly inspired by this paper…"/><meta data-react-helmet="true" property="og:url" content="https://040code.github.io/2018/03/04/verlet-integration"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Verlet Integration | 040code"/><meta data-react-helmet="true" property="og:description" content="IntroductionIn this post we’re going to dive into physics simulation with Clojure. The
ideas in this post were mostly inspired by this paper…"/><meta data-react-helmet="true" property="og:image" content="https://040code.github.io/static/2018-03-04-verlet-integration-fb-1075812cbe4a640595cd6eb9bf2dcc6b.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="niekos77"/><meta data-react-helmet="true" name="twitter:title" content="Verlet Integration | 040code"/><meta data-react-helmet="true" name="twitter:description" content="IntroductionIn this post we’re going to dive into physics simulation with Clojure. The
ideas in this post were mostly inspired by this paper…"/><meta data-react-helmet="true" name="twitter:image" content="https://040code.github.io/static/2018-03-04-verlet-integration-tw-820fb699d279aa3f0001635eaa2555d7.png"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-d3585b476d6c86bf0aca.js"/><link as="script" rel="preload" href="/app-715171e8e5cdae933bb8.js"/><link as="script" rel="preload" href="/12-cbf59fa61e7940293698.js"/><link as="script" rel="preload" href="/1-3099f1d3f2cac6acf06b.js"/><link as="script" rel="preload" href="/styles-13d2ee47eddc5325ccbc.js"/><link as="script" rel="preload" href="/webpack-runtime-389ab729a3ab3381b55f.js"/><link as="fetch" rel="preload" href="/static/d/237/path---2018-03-04-verlet-integration-265-924-34vmoOGzgZqkYjiSr03lbSSqFNQ.json" crossorigin="use-credentials"/></head><body><noscript>This site runs best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="SideMenu__StyledBurgerMenu-uekpe8-0 hTmxqc"><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/">🏡 040 blog</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/niek">Niek Palm</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/maarten">Maarten Metz</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/jeroen">Jeroen Knoops</a><a class="bm-item SideMenu__MenuLink-uekpe8-1 lcZENV" style="display:block" tabindex="-1" href="/authors/stefan">Stefan van den Oord</a></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><span style="position:absolute;top:6px;right:14px"><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(45deg)"></span><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(-45deg)"></span></span><button style="position:absolute;left:0;top:0;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button></div></div></div><div><div class="bm-burger-button" style="z-index:1000"><span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:0%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:40%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:80%;opacity:1"></span></span><button style="position:absolute;left:0;top:0;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button></div></div></div></div><div style="margin:0 0"><div style="background-image:url(&quot;/static/ehv-noord-d6ba9047bcc3ffc35364d14fb5af82f9.jpg&quot;)" class="Hero__HeroContainer-sc-1i1rqpz-0 lfoWPa"><div class="Hero__TitleContainer-sc-1i1rqpz-1 hPmQYh"><h1 class="Hero__HeroTitle-sc-1i1rqpz-3 dANmgz">Verlet Integration</h1><h2 class="Hero__HeroSubtitle-sc-1i1rqpz-4 brBAvj">Physics Simulation in Clojure</h2><span class="Hero__DateAndAuthor-sc-1i1rqpz-5 hpDnww">by:<!-- --> <a class="Hero__AuthorLink-sc-1i1rqpz-6 bWPqAN" href="/authors/maarten">maarten</a>  on <!-- -->2018-03-04</span></div></div><main role="main" class="Wrapper-aej7i5-0 hwkicN"><article class="Article__ArticleWrapper-sc-1nyoqfc-0 iTdcdb"><section><header class="ContentHeader__Header-sc-1uw779c-0 jRHVYT"><div class="TagList__ListContainer-sc-1uj42o2-0 kQWgFX"><a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/clojure">clojure</a> <a class="w3-round-size TagList__TagListItem-sc-1uj42o2-1 itRnbT" href="/tags/functional">functional</a></div></header><div class="Content__ContentBody-sc-1jppj8x-0 uzIVo"><h2 id="introduction"><a href="#introduction" aria-label="introduction permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>In this post we’re going to dive into physics simulation with Clojure. The
ideas in this post were mostly inspired by <a href="http://graphics.cs.cmu.edu/nsp/course/15-869/2006/papers/jakobsen.htm">this paper by Thomas
Jakobsen</a>.</p>
<p>My motivations for working on this toy project were:</p>
<ul>
<li>Experimenting with a very mutable domain in a language with immutability at
its core</li>
<li>Having some fun by making a lot happen on screen without writing lots of code</li>
<li>Coding using emacs &#x26; <a href="https://github.com/clojure-emacs/cider">CIDER</a> (The
<code class="language-text">C</code>lojure <code class="language-text">I</code>nteractive <code class="language-text">D</code>evelopment <code class="language-text">E</code>nvironment that <code class="language-text">R</code>ocks)</li>
</ul>
<p>The source code can be found <a href="https://github.com/mmzsource/verlet">here</a>.
The result:</p>

          <div
            class="gatsby-resp-iframe-wrapper"
            style="padding-bottom: 114.375%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem"
          >
            <iframe src="https://player.vimeo.com/video/258632942" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
          "></iframe>
          </div>
          
<h2 id="one-code-classlanguage-textmain-code-to-bind-them-all"><a href="#one-code-classlanguage-textmain-code-to-bind-them-all" aria-label="one code classlanguage textmain code to bind them all permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>One <code class="language-text">main-</code> to bind them all</h2>
<p>This code uses the <a href="https://github.com/quil/quil">Quil library</a> to render points
and lines. In the <code class="language-text">main-</code> function, the <code class="language-text">sketch</code> macro from the Quil library is
used to bind the physics domain to the UI.</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> -main <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span>quil/sketch
    <span class="token operator">:host</span>           -main
    <span class="token operator">:title</span>          <span class="token string">"Verlet Integration"</span>
    <span class="token operator">:size</span>           <span class="token punctuation">[</span>width height<span class="token punctuation">]</span>
    <span class="token operator">:setup</span>          setup
    <span class="token operator">:update</span>         update-state
    <span class="token operator">:draw</span>           draw
    <span class="token operator">:key-pressed</span>    key-pressed
    <span class="token operator">:mouse-pressed</span>  mouse-pressed
    <span class="token operator">:mouse-dragged</span>  mouse-dragged
    <span class="token operator">:mouse-released</span> mouse-released
    <span class="token operator">:features</span>       <span class="token punctuation">[</span><span class="token operator">:exit-on-close</span><span class="token punctuation">]</span>
    <span class="token operator">:middleware</span>     <span class="token punctuation">[</span>quil-mw/fun-mode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The sketch macro basically asks the developer to configure which ‘handler
functions’ it should call when certain events occur. For instance:</p>
<ul>
<li>a key is pressed -> call <code class="language-text">key-pressed</code></li>
<li>the mouse is pressed -> call <code class="language-text">mouse-pressed</code></li>
<li>the state of your program has to be updated -> call <code class="language-text">update-state</code></li>
<li>it’s time to draw the new state -> call <code class="language-text">draw</code></li>
<li>etc.</li>
</ul>
<p>Because I configured Quil to run in functional mode <code class="language-text">(quil-mw/fun-mode)</code>, Quil:</p>
<ul>
<li>Uses the return value from the <code class="language-text">:setup</code> function as the initial <code class="language-text">state</code></li>
<li>Passes the <code class="language-text">state</code> to each handler function to update it</li>
<li>Additionally passes a keyboard- and mouse <code class="language-text">event</code> argument to keyboard - and
mouse handler functions.</li>
</ul>
<p>The handler function signatures therefore look like this:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> draw          <span class="token punctuation">[</span>state<span class="token punctuation">]</span>       <span class="token keyword">..</span>.<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> update-state  <span class="token punctuation">[</span>state<span class="token punctuation">]</span>       <span class="token keyword">..</span>.<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> key-pressed   <span class="token punctuation">[</span>state event<span class="token punctuation">]</span> <span class="token keyword">..</span>.<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> mouse-pressed <span class="token punctuation">[</span>state event<span class="token punctuation">]</span> <span class="token keyword">..</span>.<span class="token punctuation">)</span></code></pre></div>
<h2 id="world-state"><a href="#world-state" aria-label="world state permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>World state</h2>
<p>What does a snapshot of this world state look like? <code class="language-text">key-pressed</code> gives some
hints:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> key-pressed
  <span class="token punctuation">[</span>state event<span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>raw-key   <span class="token punctuation">(</span><span class="token operator">:raw-key</span> event<span class="token punctuation">)</span>
        new-state <span class="token punctuation">(</span><span class="token keyword">cond</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \<span class="token number">b</span> raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>load-world <span class="token punctuation">(</span>load-<span class="token number">a</span>-file <span class="token string">"blocks.edn"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \<span class="token number">c</span> raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>load-world <span class="token punctuation">(</span>load-<span class="token number">a</span>-file <span class="token string">"cloth.edn"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \p raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>load-world <span class="token punctuation">(</span>load-<span class="token number">a</span>-file <span class="token string">"points.edn"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \s raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>load-world <span class="token punctuation">(</span>load-<span class="token number">a</span>-file <span class="token string">"sticks.edn"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \i raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>show-info-message<span class="token punctuation">)</span>
                   <span class="token punctuation">(</span><span class="token keyword">=</span> \q raw-key<span class="token punctuation">)</span> <span class="token punctuation">(</span>quil/exit<span class="token punctuation">)</span>
                   <span class="token operator">:else</span> state<span class="token punctuation">)</span><span class="token punctuation">]</span>
    new-state<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>So on pressing a key, a certain world is loaded. Let’s look into the ‘sticks’
world:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">{</span><span class="token operator">:points</span> <span class="token punctuation">{</span><span class="token operator">:p0</span> <span class="token punctuation">{</span><span class="token operator">:x</span>  <span class="token number">10</span> <span class="token operator">:y</span>   <span class="token number">1</span> <span class="token operator">:oldx</span>   <span class="token number">0</span> <span class="token operator">:oldy</span>   <span class="token number">0</span><span class="token punctuation">}</span>
          <span class="token operator">:p1</span> <span class="token punctuation">{</span><span class="token operator">:x</span> <span class="token number">100</span> <span class="token operator">:y</span> <span class="token number">100</span> <span class="token operator">:oldx</span> <span class="token number">100</span> <span class="token operator">:oldy</span> <span class="token number">100</span><span class="token punctuation">}</span>
          <span class="token operator">:p2</span> <span class="token punctuation">{</span><span class="token operator">:x</span>   <span class="token number">0</span> <span class="token operator">:y</span> <span class="token number">500</span> <span class="token operator">:oldx</span>   <span class="token number">0</span> <span class="token operator">:oldy</span> <span class="token number">525</span><span class="token punctuation">}</span>
          <span class="token operator">:p3</span> <span class="token punctuation">{</span><span class="token operator">:x</span>  <span class="token number">25</span> <span class="token operator">:y</span> <span class="token number">475</span> <span class="token operator">:oldx</span>   <span class="token number">0</span> <span class="token operator">:oldy</span> <span class="token number">525</span><span class="token punctuation">}</span>
          <span class="token operator">:p4</span> <span class="token punctuation">{</span><span class="token operator">:x</span> <span class="token number">250</span> <span class="token operator">:y</span> <span class="token number">200</span> <span class="token operator">:oldx</span> <span class="token number">250</span> <span class="token operator">:oldy</span> <span class="token number">200</span> <span class="token operator">:pinned</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
          <span class="token operator">:p5</span> <span class="token punctuation">{</span><span class="token operator">:x</span> <span class="token number">350</span> <span class="token operator">:y</span> <span class="token number">100</span> <span class="token operator">:oldx</span> <span class="token number">350</span> <span class="token operator">:oldy</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
 <span class="token operator">:sticks</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">:links</span>  <span class="token punctuation">[</span><span class="token operator">:p0</span> <span class="token operator">:p1</span><span class="token punctuation">]</span> <span class="token operator">:length</span> <span class="token number">138</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">:links</span>  <span class="token punctuation">[</span><span class="token operator">:p2</span> <span class="token operator">:p3</span><span class="token punctuation">]</span> <span class="token operator">:length</span>  <span class="token number">40</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">:links</span>  <span class="token punctuation">[</span><span class="token operator">:p4</span> <span class="token operator">:p5</span><span class="token punctuation">]</span> <span class="token operator">:length</span> <span class="token number">140</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre></div>
<p>Nothing special here. Just a map containing <code class="language-text">:points</code> and <code class="language-text">:sticks</code>. We’ll dive
into the particulars of points and sticks soon.</p>
<h2 id="physics-simulation"><a href="#physics-simulation" aria-label="physics simulation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Physics Simulation</h2>
<p>This physics simulation deals with Points, and Sticks connecting Points. The
Points are the things that seem to have direction and speed, are influenced by
gravity and lose speed because of friction or because of bouncing against world
borders. The Sticks try to keep their 2 Points apart according to the configured
Stick length. The simulation loop boils down to:</p>
<ul>
<li>Update Points</li>
<li>Apply Stick constraints</li>
<li>Apply world constraints</li>
</ul>
<p>In code:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> update-state
  <span class="token punctuation">[</span>state<span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">->></span> state
       <span class="token punctuation">(</span>update-points<span class="token punctuation">)</span>
       <span class="token punctuation">(</span>apply-stick-constraints<span class="token punctuation">)</span>
       <span class="token punctuation">(</span>apply-world-constraints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>This code can be read like this: ‘with <code class="language-text">state</code>, first <code class="language-text">update-points</code>, then
<code class="language-text">apply-stick-constraints</code>, and finally <code class="language-text">apply-world-constrains</code>‘.</p>
<h3 id="points"><a href="#points" aria-label="points permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Points</h3>
<p>Points are the main abstraction in this code. I decided to use a record to name
them:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defrecord</span> Point <span class="token punctuation">[</span>x y oldx oldy pinned<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>A Point stores its current coordinates and the coordinates it had in the
previous world state. On top of that it has a <code class="language-text">pinned</code> property which indicates
if a Point is pinned in space and - as a result - stays on the same coordinate.
A pinned Point can be unpinned by clicking it with the mouse pointer.</p>
<p>The <code class="language-text">update-point</code> function calculates the velocity of the Point and adds some
gravity in the mix:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> update-point
  <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">:keys</span> <span class="token punctuation">[</span>x y oldx oldy pinned<span class="token punctuation">]</span> <span class="token operator">:as</span> point<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">if</span> pinned
    point
    <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>vx <span class="token punctuation">(</span>velocity x oldx<span class="token punctuation">)</span>
          vy <span class="token punctuation">(</span>velocity y oldy<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">+</span> x vx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">+</span> y vy gravity<span class="token punctuation">)</span> x y pinned<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Reading superficially, this code says: if the Point is pinned then return the
same Point. Otherwise, calculate it’s velocity (based on the current - and
previous x &#x26; y coordinates), add some gravity in the y direction and return the
newly calculated Point.</p>
<p>The function uses
<a href="https://gist.github.com/john2x/e1dca953548bfdfb9844">destructuring</a> to name all
the arguments of the incoming Point. With destructuring, you can bind the
values in a data structure without explicitly querying the data structure. So
instead of getting each and every value out of Point and binding it to a ‘new’
name…</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x      <span class="token punctuation">(</span><span class="token operator">:x</span>      point<span class="token punctuation">)</span>
      y      <span class="token punctuation">(</span><span class="token operator">:y</span>      point<span class="token punctuation">)</span>
      oldx   <span class="token punctuation">(</span><span class="token operator">:oldx</span>   point<span class="token punctuation">)</span>
      oldy   <span class="token punctuation">(</span><span class="token operator">:oldy</span>   point<span class="token punctuation">)</span>
      pinned <span class="token punctuation">(</span><span class="token operator">:pinned</span> point<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">..</span>.<span class="token punctuation">)</span></code></pre></div>
<p>… you can very effectively tell the function that it will receive a map <code class="language-text">{}</code>
with keys <code class="language-text">x y oldx oldy pinned</code> and that this function should have those
variables available under the same name:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">:keys</span> <span class="token punctuation">[</span>x y oldx oldy pinned<span class="token punctuation">]</span> <span class="token operator">:as</span> point<span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre></div>
<p>The code in my repository has some additional type hints, because I wanted the
simulation to run smooth on my laptop and wanted to learn a bit more about type
hinting and compiler optimizations.</p>
<p>And that’s it with regard to Points. In a couple of lines of code Points are
already moving and reacting to gravity in the simulation.</p>
<h3 id="world-constraints"><a href="#world-constraints" aria-label="world constraints permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>World constraints</h3>
<p>It’s time for Points to meet the harsh reality of life. Walls are harder than
Points and therefore Points should bounce off of them:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> hit-floor?       <span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">></span> y height<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> hit-ceiling?     <span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">&lt;</span> y <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> hit-left-wall?   <span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">&lt;</span> x <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> hit-right-wall?  <span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">></span> x width<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token punctuation">(</span><span class="token keyword">defn</span> apply-world-constraint
  <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">:keys</span> <span class="token punctuation">[</span>x y oldx oldy pinned<span class="token punctuation">]</span> <span class="token operator">:as</span> point<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>vxb <span class="token punctuation">(</span><span class="token keyword">*</span> <span class="token punctuation">(</span>velocity x oldx<span class="token punctuation">)</span> bounce<span class="token punctuation">)</span>
        vyb <span class="token punctuation">(</span><span class="token keyword">*</span> <span class="token punctuation">(</span>velocity y oldy<span class="token punctuation">)</span> bounce<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span>
      <span class="token punctuation">(</span>hit-ceiling?    y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>miry <span class="token punctuation">(</span><span class="token keyword">-</span> oldy<span class="token punctuation">)</span><span class="token punctuation">]</span>
                             <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">+</span> oldx vxb<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">+</span> miry <span class="token punctuation">(</span><span class="token keyword">-</span> vyb<span class="token punctuation">)</span><span class="token punctuation">)</span> oldx miry pinned<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>hit-floor?      y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>miry <span class="token punctuation">(</span><span class="token keyword">+</span> height height <span class="token punctuation">(</span><span class="token keyword">-</span> oldy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                             <span class="token punctuation">(</span><span class="token keyword">-</span>>Point  <span class="token punctuation">(</span><span class="token keyword">+</span> oldx vxb<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">-</span> miry vyb<span class="token punctuation">)</span> oldx miry pinned<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>hit-left-wall?  x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>mirx <span class="token punctuation">(</span><span class="token keyword">-</span> oldx<span class="token punctuation">)</span><span class="token punctuation">]</span>
                             <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">+</span> mirx <span class="token punctuation">(</span><span class="token keyword">-</span> vxb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">+</span> oldy vyb<span class="token punctuation">)</span> mirx oldy pinned<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>hit-right-wall? x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>mirx <span class="token punctuation">(</span><span class="token keyword">+</span> width width <span class="token punctuation">(</span><span class="token keyword">-</span> oldx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                             <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">-</span> mirx vxb<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">+</span> oldy vyb<span class="token punctuation">)</span> mirx oldy pinned<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">;; else: free movement</span>
      <span class="token operator">:else</span> point<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>To explain what happens here, a picture might help.</p>
<a href="#">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 366px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAB/ElEQVQ4y41UTW/aQBD1303/SVqpOXFsLkhtOXBBSIQeUKFVP6RUnCCIEBA24BpjvkEuCF78Joy7pm5aS09e74zfzJuZXWs2m2E6nf4Tph/XislkguFwKPtBEMB6ckg6nhOkEfPn9XqN1t0d3lxfYxWtuW8lHWf/RUqsViv0ej28uLiAbTuYz+fiby2XS4lGmFJMYhP8UWUOBgO0Wq2YTAir1So8b4z9fh85Bqm1Mtee5wmZ7/tYLBYi+8n/RMi08/k8isUiwvCXRDfl8s0MuCaR67p/KDCTsJhZpVJBqVQS2SSkg5aATiTRrJRcQT9TkTQlDEPsdjuMxz5Go1H0HkvR6cBvlUeQUGHuxYSMTtn9fl+KTLTbbdTrdTSbTTiOI6Ddtu1U0K4NsyiRhWYWzIxGEjKIvmlTu8L85johebPZiERm1Ol0xMBxYkTWjqT8kfK0GTIqRtO03tbhcEA2m0Umk4lHwOweSbhuNBoSUAkYgIkQv2c4kvzj9hY35Q/odrvx8TkfC3NsHh66cKI68/n+7Qs+ff6KXTQp8WCTyHV/JiKlHTstA2vORl5dvcb7d29xf99B7WMV/ulQyNHTWyMInr9d9Hu73aJQKKBWq+HVy0uUb8pCmLgc0kj+dttQyfF4lBLkcjkJEDfl/Kw+dzGYflTE2vJAiO20/whuQ/HZDumZpwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
    <picture>
        <source srcset="/static/011bd2ac37ea96e5e9f8fb6aace495b0/cc182/world-constraints.webp 148w,
/static/011bd2ac37ea96e5e9f8fb6aace495b0/f7e40/world-constraints.webp 295w,
/static/011bd2ac37ea96e5e9f8fb6aace495b0/26f56/world-constraints.webp 366w" sizes="(max-width: 366px) 100vw, 366px" type="image/webp">
        <source srcset="/static/011bd2ac37ea96e5e9f8fb6aace495b0/cf440/world-constraints.png 148w,
/static/011bd2ac37ea96e5e9f8fb6aace495b0/d2d38/world-constraints.png 295w,
/static/011bd2ac37ea96e5e9f8fb6aace495b0/a038c/world-constraints.png 366w" sizes="(max-width: 366px) 100vw, 366px" type="image/png">
        <img class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" src="/static/011bd2ac37ea96e5e9f8fb6aace495b0/a038c/world-constraints.png" alt="apply world constraints diagram" title>
      </picture>
  </span>
</a>
<p>Imagine a Point moved from A to B in the last Point update. This means a Point
record is persisted with its <code class="language-text">x</code> and <code class="language-text">y</code> being the coordinates of B and <code class="language-text">oldx</code>
and <code class="language-text">oldy</code> being the coordinates of A. If a wall line crossed the imaginary line
A-B, the Point history should be rewritten. In essence, line A-B is mirrored in
the wall it hits, giving rise to another imaginary line C-D where C mirrors A
and D mirrors B. The <code class="language-text">miry</code> (mirror-y) and <code class="language-text">mirx</code> (mirror-x) variables in the
code contain C coordinates mirroring A coordinates.</p>
<p>The simulation will take a little velocity loss into account when bouncing at
walls. Therefore, D’ is calculated by using the x and y velocities (vx and vy)
multiplied by a bounce factor (leading to the <code class="language-text">vxb</code> and <code class="language-text">vyb</code> variables in the
code).</p>
<p>When the world state is drawn, the Point will fly off in exactly the right
direction. Additionally, because of the history rewrite, subsequent Point
updates will keep moving the Point in the right direction.</p>
<p>The picture shows the situation when hitting the ceiling. Hitting the floor and
the walls works similar. And that’s all the math and code you need to simulate
Points moving in a bounded space. Now let’s add Sticks to the simulation.</p>
<h3 id="stick-constraints"><a href="#stick-constraints" aria-label="stick constraints permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stick constraints</h3>
<p>Not only walls are restricting Points from free movement; Sticks also constrain
them. A Stick connects 2 Points and has a configured length. The goal of the
Stick constraint is to move the Points at the end of the Stick to the configured
length of the Stick.</p>
<a href="#">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.18316831683168%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABB0lEQVQoz3WSV47DMAxEc//jGQZc5LJx7+0CjB+zNLzB5mNgURGHT6M81nWVeZ5lHEeZpukSdd/30ratahgG4eyyLNf3U5x52I/WhLquU7MsyyRJElVRFH8MP8U+EGoIUV3XSmq0VVXpPsaI9TcyG6KE+75L0zTieZ4amRl1WZaSpqm4kxDq4zi0cdu2f6WGENkUNu/4rKEbR2Lo1dTU3tYIM72yc06boLQMqYmAA5CSJcpzlIuLnZKz9/x5/mZcaixXhjTbY9iLv6dOmuv9H8AN5lttMVyvTANG0Pi+L0EQyHSaQhFFkRJEUShxHEsYhu9cz5uZLJ7L0Ex5IMQ06m/hf8o8MH4BFASfEpTgswAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
    <picture>
        <source srcset="/static/6dd99e14345c35fe8d067418c788338b/cc182/stick-constraints.webp 148w,
/static/6dd99e14345c35fe8d067418c788338b/f7e40/stick-constraints.webp 295w,
/static/6dd99e14345c35fe8d067418c788338b/1a2f4/stick-constraints.webp 590w,
/static/6dd99e14345c35fe8d067418c788338b/37d0a/stick-constraints.webp 808w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp">
        <source srcset="/static/6dd99e14345c35fe8d067418c788338b/cf440/stick-constraints.png 148w,
/static/6dd99e14345c35fe8d067418c788338b/d2d38/stick-constraints.png 295w,
/static/6dd99e14345c35fe8d067418c788338b/b9e4f/stick-constraints.png 590w,
/static/6dd99e14345c35fe8d067418c788338b/4fa70/stick-constraints.png 808w" sizes="(max-width: 590px) 100vw, 590px" type="image/png">
        <img class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" src="/static/6dd99e14345c35fe8d067418c788338b/b9e4f/stick-constraints.png" alt="apply stick constraints diagram" title>
      </picture>
  </span>
</a>
<p>Instead of trying to calculate the solution that satisfies all Stick constraints
at once, this code simply looks at one Stick at a time and ‘solves’ the
constraint problem by repeatedly solving Stick constraints in isolation.</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> apply-stick-constraint
  <span class="token punctuation">[</span><span class="token punctuation">{</span>length <span class="token operator">:length</span> <span class="token operator">:as</span> stick<span class="token punctuation">}</span>
   <span class="token punctuation">{</span>p0x <span class="token operator">:x</span> p0y <span class="token operator">:y</span> oldp0x <span class="token operator">:oldx</span> oldp0y <span class="token operator">:oldy</span> pinp0 <span class="token operator">:pinned</span> <span class="token operator">:as</span> p0<span class="token punctuation">}</span>
   <span class="token punctuation">{</span>p1x <span class="token operator">:x</span> p1y <span class="token operator">:y</span> oldp1x <span class="token operator">:oldx</span> oldp1y <span class="token operator">:oldy</span> pinp1 <span class="token operator">:pinned</span> <span class="token operator">:as</span> p1<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token operator">:keys</span> <span class="token punctuation">[</span>dx dy distance<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">(</span>distance-map p0 p1<span class="token punctuation">)</span>
        <span class="token keyword">difference</span> <span class="token punctuation">(</span><span class="token keyword">-</span> length distance<span class="token punctuation">)</span>
        fraction   <span class="token punctuation">(</span><span class="token keyword">/</span> <span class="token punctuation">(</span><span class="token keyword">/</span> <span class="token keyword">difference</span> distance<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span>
        offsetX    <span class="token punctuation">(</span><span class="token keyword">*</span> dx fraction<span class="token punctuation">)</span>
        offsetY    <span class="token punctuation">(</span><span class="token keyword">*</span> dy fraction<span class="token punctuation">)</span>
        p0-new     <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">-</span> p0x offsetX<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">-</span> p0y offsetY<span class="token punctuation">)</span> oldp0x oldp0y pinp0<span class="token punctuation">)</span>
        p1-new     <span class="token punctuation">(</span><span class="token keyword">-</span>>Point <span class="token punctuation">(</span><span class="token keyword">+</span> p1x offsetX<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">+</span> p1y offsetY<span class="token punctuation">)</span> oldp1x oldp1y pinp1<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">if</span> pinp0 p0 p0-new<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">if</span> pinp1 p1 p1-new<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">apply-stick-constraint</code> takes a Stick and 2 Points (P0 and P1) as arguments.
These arguments are heavily destructured. To understand what happens precisely,
the next picture might be helpful:</p>
<a href="#">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 468px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.24786324786325%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACgUlEQVQ4y3VU2XLaQBDk/z/AeXU+wSlcrrxQkJjDwgHHQHFDuBFCKxBHHjvdi0SJIw9TWq1me7tnepQyxiBg+KsVms0mhoMBut0u+r0eegzf9xEEAZSXjOSe1ooVMVL2ADe94RBfHx9R+fWOt5KD93IZjlOG666w2WxuAK/BFJ7nIWW2WwQKoofrtd08HA7Y7/c2YibJg3Ek942JGO6fnhDmfsAsFjDLJdYEnM/nWBNc8T+p15L1tICB61p2CgEGlOdqzSQxlNwwDG0kpd8DPElmkuq4YCPE0ucFfwn0/eUFz+lnFAtF5At5ZDIZ9NkwAV9KNZc1VMJut8OQTfG5Ychuz0s+Pz5QLBat/NFohPF4bCXdY3bR5UG/j1arxUNj+ErUx4j1kiWYTCb2wq0ax2/aV9zrtAVs0Xv1Wg1/CGiiRB0WM0lYsAzT6dTWM66l1sqJPXojWQmSFd+s4s9mMwuqtQzebrdtWfpU1Ol0bP61Py1DSfRpjxmTglhyRF+HxLDRaODLwwNqVFKtVPCaz+P356dleQso2qS6kX0ElqiLGCi2Kj6/e7xY9ZQiPe/WMEynEf58pQfdEzubcGVgXcpkjeFS1uJ7bPpkg04MmRCwm0aWuTMFJgIUQ43onPlidzwezw3Su+I0KbKDDtAeMnkQ/X1knXMH9U5A+fRAkG8c12w2i2q1ilw2h7LjoMABUElSZ2mSJaZ6520eO2zlRSPlssNiGpLAWy5nf3XyqByg7itOoxdLE6PlApsau8cpMf0B6vW6tYuYzOmCHfc37PJRsvlHUpdjb2p9knxuRGCbEZYdhJSzH0/Q1k+220Ot3sCajHelEkKGLY9KddVlMfwHnW86ADx5H2oAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
    <picture>
        <source srcset="/static/da387eeec0b28916536105175d5acc1b/cc182/stick-math.webp 148w,
/static/da387eeec0b28916536105175d5acc1b/f7e40/stick-math.webp 295w,
/static/da387eeec0b28916536105175d5acc1b/a57bd/stick-math.webp 468w" sizes="(max-width: 468px) 100vw, 468px" type="image/webp">
        <source srcset="/static/da387eeec0b28916536105175d5acc1b/cf440/stick-math.png 148w,
/static/da387eeec0b28916536105175d5acc1b/d2d38/stick-math.png 295w,
/static/da387eeec0b28916536105175d5acc1b/bb106/stick-math.png 468w" sizes="(max-width: 468px) 100vw, 468px" type="image/png">
        <img class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" src="/static/da387eeec0b28916536105175d5acc1b/bb106/stick-math.png" alt="stick math diagram" title>
      </picture>
  </span>
</a>
<p>Let P0 and P1 be two Points with a Stick S between them. P0 and P1 have already
been updated by the <code class="language-text">update-point</code> function and their new (x,y) coordinates are
(40,50) and (70,90) respectively. This means:</p>
<ul>
<li>dx = 30</li>
<li>dy = 40</li>
<li>distance = 50</li>
</ul>
<p>Since the Stick between P0 and P1 was configured to have a <code class="language-text">length</code> of 150, and
we want P0 and P1 to be adjusted by the same amount, P0 <em>should</em> be located at
Point S0 (10,10) and P1 <em>should</em> be located at Point S1 (100,130). This is
exactly what <code class="language-text">apply-stick-constraint</code> achieves:</p>
<ul>
<li>The <code class="language-text">difference</code> in the configured <code class="language-text">length</code> of the Stick and the <code class="language-text">distance</code> of P0
and P1 is 100</li>
<li>The <code class="language-text">fraction</code> of the <code class="language-text">distance</code> between P0 and P1 that needs to be added to
P0 AND to P1 is 1. So by extending the <code class="language-text">distance</code> P0 and P1 with exactly 50
(<code class="language-text">distance</code> times <code class="language-text">fraction</code>) in both directions, we’ll solve the Stick
constraint.</li>
<li>This is done by using <code class="language-text">offsetX</code> on P0x and P1x and using <code class="language-text">offsetY</code> on P0y and
P1y</li>
</ul>
<p>Conceptually a scaled helper triangle is used to move P0 and an identical scaled
helper triangle is used to move P1. The scale of this triangle is determined by
the <code class="language-text">fraction</code> which in this case is 1. These triangles are depicted in red.</p>
<p>Each Stick in the world is updated before a new world frame is drawn. It is very
well possible that the neatly placed P0 and P1 are moved to different
coordinates by another Stick constraint before the complete update is over. This
sometimes results in wiggly behavior, although in most cases, the simulation
is perceived to behave naturally.</p>
<h2 id="drawing"><a href="#drawing" aria-label="drawing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Drawing</h2>
<p>Finally, the Points and Sticks have to be drawn on screen:</p>
<div class="gatsby-highlight" data-language="clojure"><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> draw
  <span class="token punctuation">[</span>state<span class="token punctuation">]</span>
  <span class="token punctuation">(</span>quil/background <span class="token number">255</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">:info-message</span> state<span class="token punctuation">)</span>
    <span class="token punctuation">(</span>quil/text info-message <span class="token number">20</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">do</span>
      <span class="token punctuation">(</span><span class="token keyword">doseq</span> <span class="token punctuation">[</span>point <span class="token punctuation">(</span><span class="token keyword">vals</span> <span class="token punctuation">(</span><span class="token operator">:points</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">(</span>quil/ellipse <span class="token punctuation">(</span><span class="token operator">:x</span> point<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">:y</span> point<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span><span class="token keyword">doseq</span> <span class="token punctuation">[</span>stick <span class="token punctuation">(</span><span class="token operator">:sticks</span> state<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>points <span class="token punctuation">(</span><span class="token operator">:points</span> state<span class="token punctuation">)</span>
              p0     <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">first</span> <span class="token punctuation">(</span><span class="token operator">:links</span> stick<span class="token punctuation">)</span><span class="token punctuation">)</span> points<span class="token punctuation">)</span>
              p1     <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">last</span>  <span class="token punctuation">(</span><span class="token operator">:links</span> stick<span class="token punctuation">)</span><span class="token punctuation">)</span> points<span class="token punctuation">)</span><span class="token punctuation">]</span>
          <span class="token punctuation">(</span>quil/line <span class="token punctuation">(</span><span class="token operator">:x</span> p0<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">:y</span> p0<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">:x</span> p1<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">:y</span> p1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Start by clearing the screen. If there is an <code class="language-text">:info-message</code> entry in the
<code class="language-text">state</code>, draw the <code class="language-text">info-message</code>. Otherwise draw all Points in <code class="language-text">state</code> as a
quil/ellipse and draw all Sticks as a quil/line. And that’s all folks!</p>
<h2 id="conclusion"><a href="#conclusion" aria-label="conclusion permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>As always, it was a pleasure working with Clojure. It turns out to be easy to
work in a very mutable domain with mostly pure functions, also thanks to the
excellent Quil library.</p>
<p>My current version of <a href="https://github.com/AlDanial/cloc">cloc</a> tells me that
core.clj is 230 lines long, but it counts the function documentation as code.
Therefore, I ran a new <code class="language-text">cloc</code> command without the doc strings. It then counts
159 lines of clojure, approximately half of which are dedicated to UI
interaction and the other half to physics simulation. Not bad at all!</p>
<p>I’m glad I decided to ‘bite the bullet’ and learn Emacs and CIDER. I now use
Emacs for all my Clojure(script) development. In addition, I use Emacs for most
of my text editing these days including writing and planning.</p>
<p>I’d like to thank Michiel Borkent a.k.a.
<a href="https://twitter.com/borkdude">@borkdude</a> for reviewing an earlier version of
the code and giving me very helpful feedback. Faults and not-so-idiomatic
Clojure code remaining are my own.</p>
<p>Please share your comments, suggestions and thoughts about this blog post on
<a href="https://twitter.com/mmz_">twitter.com/mmz_</a>. Thanks for reading and Happy
Coding!</p>
<h2 id="links"><a href="#links" aria-label="links permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Links</h2>
<ul>
<li><a href="http://graphics.cs.cmu.edu/nsp/course/15-869/2006/papers/jakobsen.htm">Verlet integration
paper</a></li>
<li><a href="https://github.com/mmzsource/verlet">My verlet integration code in clojure</a></li>
<li><a href="https://github.com/quil/quil">Quil library</a></li>
<li><a href="https://github.com/clojure-emacs/cider">Emacs CIDER plugin</a></li>
<li><a href="https://github.com/AlDanial/cloc">Cloc - counting lines of code</a></li>
</ul></div></section></article></main></div><footer class="Footer__FooterWrapper-sc-1oxe0wr-0 hFicPH"><nav><div class="footer-col"><h5 class="footer-title">040 code © 2019</h5><span class="footer-item">Buildt with <i></i><a class="footer-link" href="https://www.gatsbyjs.org/">Gatsby</a></span></div><div class="footer-col"><h5 class="footer-title">Blog</h5><span class="footer-item"><a class="footer-link" href="/">home</a></span><span class="footer-item"><a class="footer-link" href="/about">about</a></span></div><div class="footer-col"><h5 class="footer-title">Source</h5><span class="footer-item"><i></i><a class="footer-link" href="https://github.com/040code/">Github</a></span></div></nav></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-97020149-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2018-03-04-verlet-integration-265","path":"/2018/03/04/verlet-integration"};window.dataPath="237/path---2018-03-04-verlet-integration-265-924-34vmoOGzgZqkYjiSr03lbSSqFNQ";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-715171e8e5cdae933bb8.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-368195141fa42f7ac926.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-c731dbdbd2c1d3ac0ca7.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-d3585b476d6c86bf0aca.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-c38f6120b6c471d68560.js"],"component---src-templates-authors-js":["/component---src-templates-authors-js-63378b91d8ce3776815c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-74e4d98cf600ca3e6d71.js"],"pages-manifest":["/pages-manifest-3bcd0cd5ebb6b849d2ce.js"]};/*]]>*/</script><script src="/webpack-runtime-389ab729a3ab3381b55f.js" async=""></script><script src="/styles-13d2ee47eddc5325ccbc.js" async=""></script><script src="/1-3099f1d3f2cac6acf06b.js" async=""></script><script src="/12-cbf59fa61e7940293698.js" async=""></script><script src="/app-715171e8e5cdae933bb8.js" async=""></script><script src="/component---src-templates-blog-post-js-d3585b476d6c86bf0aca.js" async=""></script></body></html>