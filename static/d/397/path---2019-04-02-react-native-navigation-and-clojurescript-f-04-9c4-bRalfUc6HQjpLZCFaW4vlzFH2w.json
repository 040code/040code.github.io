{"data":{"markdownRemark":{"id":"96d0a24d-95ad-5e2c-83d2-8e78982b3703","excerpt":"React Native Navigation and ClojureScriptA beginner’s guide to realizing proper navigation in a React Native application\nusing ClojureScript…","html":"<h1 id=\"react-native-navigation-and-clojurescript\"><a href=\"#react-native-navigation-and-clojurescript\" aria-label=\"react native navigation and clojurescript permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Native Navigation and ClojureScript</h1>\n<p><em>A beginner’s guide to realizing proper navigation in a React Native application\nusing ClojureScript and shadow-cljs</em></p>\n<p style=\"text-align: right\">\n  <a href=\"https://github.com/svdo/CLJSReactNativeNavigation\" target=\"sourcecode\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 120px;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACc0lEQVQ4y3VUsWpUQRR9+1ZJ6vDuzNuNIPgDKVMEm4AWEo2kClrah7DESm22sEljk07LpLAKgiRsYZDYh5g2IJYLipAI0d1k13Nnzry9m8QHh5m5c++ZM3fPbObFZfr5wmVOpJ7xc+LmsPca2AUOsT7kXGNzVV7h6hUHRw1iITUSzWJjDxiWzg9L8UOdhzXmGuNac2ZZU0N9VrFqgPOVVAz0gR7Hc6LvCulBQN/krbC2FhSCLGegZU5PygamMGEwpjrWtMiR88oyb0g6wBMc9Elj6KuqPMF44uN8CIW69xR97xjy+XTlHBsH5rQ1HpJrEohnMJ/COIX1DGPpVmvmVgc4KNfgUhkDZ9xcj8lyI/vP54u4p7msOSPHklplU4Ngj9cRtxB/OakDqjKHwpoCh+RUXifhAtX1IodsavB41HDZr1QkT13zuWSRmLdvfrBj7VWwBqW/TX2N3rxKqrEAKOX6HWuDzdTUA0O4NTJqMPs1/Qu+Db4j4ZYhHGigayR/1eTYr5H7oyJnFda89jXOj1I9WtFVhZ0QKOSCfXxIlaH5frxfWYxVtllMr6qMHB0lXKXkX9z8Ddwf/xFGCo11HiDvJ2v+kmNVT3HAKeR+A5Yx/87Nz1D3AtefNAongVfAl0tvXq/7A6NPia2GL3VzG7gLNd2mb+j6o3n46UfYYa6640JdQgHPL9thu4lEJDzDfBq4B4ghTK/jJQn+mKt+sEQ8WSbQq10mvAfeAI9GvkzPTdrMOQ9jITuYT1gudX5uDmhrT241ppHsNhi7aRSuN0tth5yCrG3q8rEnVrFH896mwsXqH0nSy5DHULuB2J2rt3TZP3DP+m6bnZlRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n    <picture>\n        <source srcset=\"/static/ef7a02b69836dc8b6a732a54c4200dcb/e7272/GitHub-Mark-120px-plus.webp 120w\" sizes=\"(max-width: 120px) 100vw, 120px\" type=\"image/webp\">\n        <source srcset=\"/static/ef7a02b69836dc8b6a732a54c4200dcb/332be/GitHub-Mark-120px-plus.png 120w\" sizes=\"(max-width: 120px) 100vw, 120px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" src=\"/static/ef7a02b69836dc8b6a732a54c4200dcb/332be/GitHub-Mark-120px-plus.png\" alt=\"GitHub\" title>\n      </picture>\n  </span>Source code for this post</a></p>\n<p>That’s a big bunch of words. Let me briefly introduce them to you, so that I can\nthen dive deeper into some of them. “Beginner” in this case means that, a week\nbefore I started doing this, I had practically zero experience with\nClojure(Script) and React Native. I do have quite a bit of experience using\nReact, and also writing native iOS applications (Swift/Objective-C).</p>\n<p>“Guide” means that I’m going to explain to you how I accomplished my goal.\nYou’ll have to interpret it and follow along if you want to do the same. Future\nversions of any of the tools may break this guide.</p>\n<p><a href=\"https://wix.github.io/react-native-navigation\">React Native Navigation</a> is a framework for <a href=\"https://facebook.github.io/react-native\">React Native</a>. Which is a\nframework for building cross-platform apps for iOS and Android using JavaScript,\nbut you probably already knew that part. <a href=\"https://clojurescript.org\">ClojureScript</a> is a functional\nprogramming language. It’s a variant of Clojure that compiles to JavaScript.\n“Proper navigation” is, admittedly, a bit subjective; I’ll explain this part in\nmore detail below. Finally, <a href=\"http://shadow-cljs.org\">shadow-cljs</a> is the toolchain I used\nas an easy way to integrate a bunch of ClojureScript code into an originally\nJavascript-based project.</p>\n<p>A summary of this guide is:</p>\n<ol>\n<li>Setup a new React Native project (using <code class=\"language-text\">react-native</code> cli).</li>\n<li>Add shadow-cljs to be able to use ClojureScript in that project.</li>\n<li>Add and setup <code class=\"language-text\">react-native-navigation</code> dependency.</li>\n<li>Create a bit of infrastructure on the ClojureScript side to be able to use\nthe React Native Navigation APIs while using shadow-cljs’ hot reloading.</li>\n</ol>\n<p>So let’s get started. I executed all these steps exactly as I’m describing here,\nthe result of which you can find in <a href=\"https://github.com/svdo/CLJSReactNativeNavigation\">my GitHub repo</a>. Commit messages\ninclude all details about the commands I used. If you want to read my\nrant about wanting to use native navigation, keep reading till the very end of\nthis post :)</p>\n<blockquote>\n<p>Please note that this post <em>does not</em> include all the code that you need\nto make it work, that would be too much for a web page. Please refer to\n<a href=\"https://github.com/svdo/CLJSReactNativeNavigation\">the final solution in my GitHub repo</a> if you want to reproduce all of it.</p>\n</blockquote>\n<h1 id=\"1-create-react-native-project\"><a href=\"#1-create-react-native-project\" aria-label=\"1 create react native project permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Create React Native Project</h1>\n<p>This step is very easy. First, if you haven’t got it yet, install\n<code class=\"language-text\">react-native-cli</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g react-native-cli</code></pre></div>\n<p>Then create a new project:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">react-native init CLJSReactNativeNavigation</code></pre></div>\n<p>So far so good, nothing new here, let’s move on.</p>\n<h1 id=\"2-add-shadow-cljs\"><a href=\"#2-add-shadow-cljs\" aria-label=\"2 add shadow cljs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Add shadow-cljs</h1>\n<p>We’re going to use the standalone version of shadow-cljs,\n<a href=\"https://shadow-cljs.github.io/docs/UsersGuide.html#_build_tool_integration\">as recommended</a>. So we add the npm dependency for shadow-cljs:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev shadow-cljs</code></pre></div>\n<p>Now we need to configure shadow-cljs a bit. We create a file called\n<code class=\"language-text\">shadow-cljs.edn</code> and give it the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">{</span><span class=\"token operator\">:source-paths</span>\n <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/main\"</span>                     <span class=\"token comment\">;; production code</span>\n  <span class=\"token string\">\"src/test\"</span><span class=\"token punctuation\">]</span>                    <span class=\"token comment\">;; yes we're going to add tests as well!</span>\n\n <span class=\"token operator\">:dependencies</span>\n <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>reagent <span class=\"token string\">\"0.8.1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\n <span class=\"token operator\">:builds</span>\n <span class=\"token punctuation\">{</span><span class=\"token operator\">:myapp</span>                         <span class=\"token comment\">;; the target definition</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:target</span> <span class=\"token operator\">:react-native</span>         <span class=\"token comment\">;; the target type</span>\n   <span class=\"token operator\">:init-fn</span> myapp/init           <span class=\"token comment\">;; react native's entry point</span>\n   <span class=\"token operator\">:output-dir</span> <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>        <span class=\"token comment\">;; where to put the built JS</span></code></pre></div>\n<p>This is telling shadow-cljs that there is a target called “myapp”, that\nit’s a React Native target, that the entry point of our app is the function\n<code class=\"language-text\">init</code> in the <code class=\"language-text\">myapp</code> namespace, and that the output should be written to the\nfolder <code class=\"language-text\">build</code>.</p>\n<p>Now let’s create that <code class=\"language-text\">myapp</code> namespace. In <code class=\"language-text\">src/main</code> create a file called\n<code class=\"language-text\">myapp.cljs</code> with the following contents:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> myapp\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>reagent.core <span class=\"token operator\">:as</span> r <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>atom<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"react-native\"</span> <span class=\"token operator\">:as</span> rn <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>AppRegistry<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> app-root <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:<span class=\"token keyword\">></span> rn/View <span class=\"token punctuation\">{</span><span class=\"token operator\">:style</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:flex-direction</span> <span class=\"token string\">\"column\"</span>\n                       <span class=\"token operator\">:margin</span> <span class=\"token number\">40</span>\n                       <span class=\"token operator\">:align-items</span> <span class=\"token string\">\"center\"</span>\n                       <span class=\"token operator\">:background-color</span> <span class=\"token string\">\"white\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n   <span class=\"token punctuation\">[</span>:<span class=\"token keyword\">></span> rn/Text <span class=\"token punctuation\">{</span><span class=\"token operator\">:style</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:font-size</span> <span class=\"token number\">30</span>\n                        <span class=\"token operator\">:font-weight</span> <span class=\"token string\">\"100\"</span>\n                        <span class=\"token operator\">:margin-bottom</span> <span class=\"token number\">20</span>\n                        <span class=\"token operator\">:text-align</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token string\">\"Hi Shadow!\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> init <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>.registerComponent AppRegistry\n                      <span class=\"token string\">\"CLJSReactNativeNavigation\"</span>\n                      #<span class=\"token punctuation\">(</span>r/reactify-component app-root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Time to check this out! Run the following commands in your terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> shadow-cljs compile myapp\n<span class=\"token function\">yarn</span> react-native run-ios</code></pre></div>\n<p>Tada!</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 545px;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 176.88073394495413%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAAsSAAALEgHS3X78AAADNklEQVRIx+2WS0hbURCGz402iWmMhbzM07w00khN6LalKEhXLrtqtxV0WQRXLoSulIrgRkyxbroxan0ghCYGwUVpqQ1BSUSUEFw0ouvEPMx05vRee7FSqlLowgPDnHvPnO/+55HMMCY2hULBrts6Ojp+PajVanKC+PjM6XSGvV7vtNFoDNtstt/MbreHTSZT2O12T2PcW6VS+ZwmNjc3M3zPWHt7uyTtRX9/P2xubsLW1hb09vaCVqsFDAQM5EZ9nU4HXV1dkEwmIRqNQl9fH6hUqpcE8Pv9CjYwMMCBZrM5kslkAFsBrXJ0dFSOxWLlRCJRXl9f554sHo+XDw8PyxRTKBSKqVQKXC7XGq1yeHhYwUZHRwmobGlp+bC9vU3ASrVaraEng1qtBqVSCYrFIpyenoLYapVKhcar2WwWfD7fR2RoFhcXBba6ukr7dxf3Lrqzs3MOPDs7A/RAXt6XvePA/f19wL2MESMSiUhnwUyo8KsIrIoKubrLjJoEPDg4OAfOz88LbHZ2lqg6h8MRvQEwjgwtXzK+JIVGVPj5IvBPTQ7EPUzRzZHfTSsCv8mA8BdAkAHTyHBykqjQjIfy6YoKuROBGWS45EBSmLyiQvke0pLtnCUCLajwy3X30OPxJJBxb2ZmRsHGxsboYmvxlNfk9/CKCvkpz83NCWx8fJyAagSu3ADI7+HCwoLAJiYmCKj6F8Dl/w7If3q3Cm9P+VbhTYHXynqTk5MciH+wy1KipyROE6ScfJmJH+V5GVMABy4tLQlsZGSEAy0Wy8ru7i4BSyRAZrULz3Ir53I5QDH0B6uZmpoSWE9Pj4AwpSAIr4eGhuD4+Bjy+TycnJwAfQBrGdjY2OBG/XQ6zcekGBQEdXV1b5qamtTd3d0CQzpDmBK/EMTS7B2Wa2lMWBkyLN/29Hp91qA3ZLG8y1LfarXuSeMYm8HK6z3OfUirDAQCP5MyAql6aETzoT1Be4r2SNOgeRXsDOZDwVCu1deaC9wPfG/UNg7i2GMxhmLbaK7IwHRnsXBfX19PJd0dVKDGOrDBYDCo7Da7ofNBZwihQX+bP4jAkNPhRMF6FcVQLM3BlXEGroj9ACFKGoB1Yrb4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n    <picture>\n        <source srcset=\"/static/d72abc30f3bffb6109f050d2ed9661db/cc182/hi-shadow.webp 148w,\n/static/d72abc30f3bffb6109f050d2ed9661db/f7e40/hi-shadow.webp 295w,\n/static/d72abc30f3bffb6109f050d2ed9661db/fa50d/hi-shadow.webp 545w\" sizes=\"(max-width: 545px) 100vw, 545px\" type=\"image/webp\">\n        <source srcset=\"/static/d72abc30f3bffb6109f050d2ed9661db/cf440/hi-shadow.png 148w,\n/static/d72abc30f3bffb6109f050d2ed9661db/d2d38/hi-shadow.png 295w,\n/static/d72abc30f3bffb6109f050d2ed9661db/53236/hi-shadow.png 545w\" sizes=\"(max-width: 545px) 100vw, 545px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" src=\"/static/d72abc30f3bffb6109f050d2ed9661db/53236/hi-shadow.png\" alt=\"Tada!\" title>\n      </picture>\n  </span>\n<h2 id=\"hot-reloading\"><a href=\"#hot-reloading\" aria-label=\"hot reloading permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hot Reloading</h2>\n<p>When using shadow-cljs, you also get its variant of hot reloading. You don’t\nneed to use the developer menu to enable it, but you do need to add a bit of\ncode to make it work: (a) you need to had a function that performs the reload,\nand (b) you need to enable hot reloading in the config.</p>\n<h3 id=\"add-reload-function\"><a href=\"#add-reload-function\" aria-label=\"add reload function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add reload function</h3>\n<p>Let me just give you the code of <code class=\"language-text\">myapp.cljs</code> and then explain what’s going on.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> myapp\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>reagent.core <span class=\"token operator\">:as</span> r <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>atom<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"react-native\"</span> <span class=\"token operator\">:as</span> rn <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>AppRegistry<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> component-to-update <span class=\"token punctuation\">(</span>atom <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> content <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:<span class=\"token keyword\">></span> rn/Text <span class=\"token punctuation\">{</span><span class=\"token operator\">:style</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:font-size</span> <span class=\"token number\">30</span>\n                       <span class=\"token operator\">:font-weight</span> <span class=\"token string\">\"100\"</span>\n                       <span class=\"token operator\">:margin-bottom</span> <span class=\"token number\">20</span>\n                       <span class=\"token operator\">:text-align</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n   <span class=\"token string\">\"Hi Shadow!\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> app-root <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:<span class=\"token keyword\">></span> rn/View <span class=\"token punctuation\">{</span><span class=\"token operator\">:style</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:flex-direction</span> <span class=\"token string\">\"column\"</span>\n                       <span class=\"token operator\">:margin</span> <span class=\"token number\">40</span>\n                       <span class=\"token operator\">:align-items</span> <span class=\"token string\">\"center\"</span>\n                       <span class=\"token operator\">:background-color</span> <span class=\"token string\">\"white\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">def</span> updatable-app-root\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">with-meta</span> app-root\n    <span class=\"token punctuation\">{</span><span class=\"token operator\">:component-did-mount</span>\n     <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>this-as ^js this\n                     <span class=\"token punctuation\">(</span>reset! component-to-update this<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> reload <span class=\"token punctuation\">{</span><span class=\"token operator\">:dev</span>/after-load <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>.forceUpdate ^js @component-to-update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> init <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>.registerComponent AppRegistry\n                      <span class=\"token string\">\"CLJSReactNativeNavigation\"</span>\n                      #<span class=\"token punctuation\">(</span>r/reactify-component updatable-app-root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This is what it does:</p>\n<ul>\n<li>The text content (“Hi Shadow!”) is extracted into a separate component\n(<code class=\"language-text\">content</code>), because the call <a href=\"https://reactjs.org/docs/react-component.html#forceupdate\"><code class=\"language-text\">forceUpdate</code></a> that we’ll use\nupdates everything <em>below</em> the application root component, not the root\ncomponent itself.</li>\n<li>The app-root component is annotated with a <code class=\"language-text\">component-did-mount</code> handler\n(<code class=\"language-text\">updatable-app-root</code>). This handler stores the actual JavaScript object\nthat represents the root component into the atom <code class=\"language-text\">component-to-update</code>.</li>\n<li>A function <code class=\"language-text\">reload</code> is added, which takes the value of that atom and calls\nthe method <a href=\"https://reactjs.org/docs/react-component.html#forceupdate\"><code class=\"language-text\">forceUpdate</code></a> on it.</li>\n</ul>\n<p>One final step remains: enabling hot reloading in <code class=\"language-text\">shadow-cljs.edn</code>. It’s new\ncontent is:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">{</span><span class=\"token operator\">:source-paths</span>\n <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/main\"</span>                     <span class=\"token comment\">;; production code</span>\n  <span class=\"token string\">\"src/test\"</span><span class=\"token punctuation\">]</span>                    <span class=\"token comment\">;; yes we're going to add tests as well!</span>\n\n <span class=\"token operator\">:dependencies</span>\n <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>reagent <span class=\"token string\">\"0.8.1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\n <span class=\"token operator\">:builds</span>\n <span class=\"token punctuation\">{</span><span class=\"token operator\">:myapp</span>                         <span class=\"token comment\">;; the target definition</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:target</span> <span class=\"token operator\">:react-native</span>         <span class=\"token comment\">;; the target type</span>\n   <span class=\"token operator\">:init-fn</span> myapp/init           <span class=\"token comment\">;; react native's entry point</span>\n   <span class=\"token operator\">:output-dir</span> <span class=\"token string\">\"build\"</span>           <span class=\"token comment\">;; where to put the built JS</span>\n   <span class=\"token operator\">:devtools</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:autoload</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">;; enables hot-reloading</span></code></pre></div>\n<p>If you reload the app, changing the text in the <code class=\"language-text\">content</code> component should\ncause the app to automatically update!</p>\n<h1 id=\"3-add-react-native-navigation\"><a href=\"#3-add-react-native-navigation\" aria-label=\"3 add react native navigation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Add React Native Navigation</h1>\n<p>This bit is a somewhat tedious I’m afraid. You’ll have to go through <a href=\"https://wix.github.io/react-native-navigation/#/docs/Installing\">the\ninstructions to setup React Native Navigation</a>. Add the npm\ndependency, update your Xcode project, update iOS source code, update Android\nbuild files, and update Android source code. Tip for Android part: Please don’t\nblindly copy-paste. Some of the instructions refer are not up to date, some\nparts are not really needed, etc. If you want you can have a look at\n<a href=\"https://github.com/svdo/CLJSReactNativeNavigation\">how I did it</a>.</p>\n<p>Obviously you’ll skip the last step of the instructions, namely the part where\nthe JavaScript code is updated to use React Native Navigation. We’ll address\nthat in ClojureScript next.</p>\n<h1 id=\"4-integrate-and-wrap\"><a href=\"#4-integrate-and-wrap\" aria-label=\"4 integrate and wrap permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Integrate and Wrap</h1>\n<p>Ok, roll up your sleeves, because here comes the interesting part.</p>\n<h2 id=\"wrapper-functionality\"><a href=\"#wrapper-functionality\" aria-label=\"wrapper functionality permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wrapper functionality</h2>\n<p>In JavaScript we would need to do something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Navigation <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native-navigation'</span>\nNavigation<span class=\"token punctuation\">.</span><span class=\"token function\">registerComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'navigation.playground.WelcomeScreen'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> App<span class=\"token punctuation\">)</span>\nNavigation<span class=\"token punctuation\">.</span><span class=\"token function\">events</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerAppLaunchedListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  Navigation<span class=\"token punctuation\">.</span><span class=\"token function\">setRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    root<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      component<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'navigation.playground.WelcomeScreen'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Obviously in ClojureScript we need to do something similar. There’s a problem\nthough: we need a handle to the actual JavaScript component in order to call\n<code class=\"language-text\">forceUpdate</code> on it (for hot reloading). React Native Navigation has made the\ndesign choice that it creates new root components for screens that you push\non the navigation stack. So also for those components we need a handle and\ncall <code class=\"language-text\">forceUpdate</code>. We accomplish this by not registering the component itself\nwith <code class=\"language-text\">Navigation</code>, but a wrapper of that component.</p>\n<p>This causes another problem though. React Native Navigation gives components\nthat you register a <code class=\"language-text\">componentId</code>. It uses this for its internal registration\nso that it can make navigation work. For example, when you push a new screen\nonto the navigation stack, it uses the <code class=\"language-text\">componentId</code> to find the screen from\nwhich you are pushing. The problem is that we registered the <em>wrapper</em>, but\nwe’re navigating from the <em>wrapped component</em>. Which does not have a\n<code class=\"language-text\">componentId</code>, because we never registered it with <code class=\"language-text\">Navigation</code>. Solution:\nmake the wrapper in such a way that it passes its <code class=\"language-text\">componentId</code> on to the\nwrapped component.</p>\n<p>But there is more! React Native Navigation defines some additional life cycle\nmethods, such as <code class=\"language-text\">navigationButtonPressed</code>. And for that to work, you need\nto call <a href=\"https://wix.github.io/react-native-navigation/#/docs/events?id=navigationbuttonpressed-event\"><code class=\"language-text\">Navigation.bindComponent</code></a>. So our wrapper also calls\n<code class=\"language-text\">bindComponent</code> and forwards <code class=\"language-text\">navigationButtonPressed</code>. Forwarding other\nlife cycle methods is left as an exercise for the reader.</p>\n<p>Here’s the main code for the wrapper (<a href=\"https://github.com/svdo/CLJSReactNativeNavigation/blob/master/src/main/env.cljc\">full version</a>):</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token comment\">;; current namespace is `env`</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> id-seq-ref <span class=\"token punctuation\">(</span>atom <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> mounted-ref <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> screens-ref <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> register <span class=\"token punctuation\">[</span><span class=\"token keyword\">key</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>get-props\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span>this<span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">{</span><span class=\"token operator\">::key</span> <span class=\"token keyword\">key</span>\n           <span class=\"token operator\">::id</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> this .-state .-id<span class=\"token punctuation\">)</span>\n           <span class=\"token operator\">:component-id</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> this .-props .-componentId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        wrapper\n        <span class=\"token punctuation\">(</span>crc #js                    <span class=\"token comment\">;; crc is create-react-class</span>\n              <span class=\"token punctuation\">{</span><span class=\"token operator\">:displayName</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span> <span class=\"token keyword\">key</span> <span class=\"token string\">\"Wrapper\"</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:getInitialState</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>id <span class=\"token punctuation\">(</span>swap! id-seq-ref <span class=\"token keyword\">inc</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> #js <span class=\"token punctuation\">{</span><span class=\"token operator\">:key</span> <span class=\"token keyword\">key</span>\n                             <span class=\"token operator\">:id</span> id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:componentDidMount</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span>bind-component this<span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">(</span>swap! mounted-ref\n                         assoc-in <span class=\"token punctuation\">[</span><span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> this .-state .-id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> this<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:componentWillUnmount</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span>swap! mounted-ref update <span class=\"token keyword\">key</span> <span class=\"token keyword\">dissoc</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> this .-state .-id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n               <span class=\"token comment\">;; FIXME: forward other lifecycles the same way</span>\n               <span class=\"token operator\">:navigationButtonPressed</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:keys</span> <span class=\"token punctuation\">[</span>navigation-button-pressed<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n                        <span class=\"token punctuation\">(</span><span class=\"token keyword\">get</span> @screens-ref <span class=\"token keyword\">key</span><span class=\"token punctuation\">)</span>\n\n                        props\n                        <span class=\"token punctuation\">(</span>get-props this<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n                    <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"navigationButtonPressed\"</span>\n                                    <span class=\"token keyword\">key</span>\n                                    <span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> navigation-button-pressed<span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">(</span><span class=\"token keyword\">pr-str</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> navigation-button-pressed\n                      <span class=\"token punctuation\">(</span>navigation-button-pressed props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:componentDidAppear</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"componentDidAppear\"</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:componentDidDisappear</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"componentDidDisappear\"</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n               <span class=\"token operator\">:render</span>\n               <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">(</span>this-as\n                  ^js this\n\n                  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:keys</span> <span class=\"token punctuation\">[</span>render<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n                        <span class=\"token punctuation\">(</span><span class=\"token keyword\">get</span> @screens-ref <span class=\"token keyword\">key</span><span class=\"token punctuation\">)</span>\n\n                        props\n                        <span class=\"token punctuation\">(</span>get-props this<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n                    <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"render\"</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">pr-str</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> <span class=\"token punctuation\">(</span>render props<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">(</span>r/as-element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token punctuation\">(</span>register-component <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This stores the mounted components in <code class=\"language-text\">mounted-ref</code>, which we can then use\nfor the hot reloading:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> reload <span class=\"token punctuation\">{</span><span class=\"token operator\">:dev</span>/after-load <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">doseq</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">key</span> instances<span class=\"token punctuation\">]</span> @mounted-ref\n          <span class=\"token punctuation\">[</span>id inst<span class=\"token punctuation\">]</span> instances<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"forceUpdate\"</span> <span class=\"token keyword\">key</span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span>.forceUpdate ^js inst<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The <code class=\"language-text\">register</code> method uses an atom <code class=\"language-text\">screens-ref</code> to forward life cycle methods,\nso we need to provide a function for screens to add themselves:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> <span class=\"token number\">add</span>-screen <span class=\"token punctuation\">[</span><span class=\"token keyword\">key</span> screen-<span class=\"token number\">def</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>swap! screens-ref <span class=\"token keyword\">assoc</span> <span class=\"token keyword\">key</span> screen-<span class=\"token number\">def</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"using-it\"><a href=\"#using-it\" aria-label=\"using it permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using it</h2>\n<p>Initially, in <code class=\"language-text\">myapp/init</code> we called React Native’s <code class=\"language-text\">registerComponent</code>. Now\nwe call our <code class=\"language-text\">env/register</code> instead. We could just call <code class=\"language-text\">(env/register &quot;App&quot;)</code>,\nbut we want to pass some options for the navigation bar.</p>\n<p>Furthermore we need to call the <code class=\"language-text\">Navigation.events().registerAppLaunchedListener</code>\nJavaScript function to set the navigation root for our app.</p>\n<p>The <code class=\"language-text\">init</code> function is now:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> init <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>env/register <span class=\"token string\">\"App\"</span>\n                <span class=\"token punctuation\">{</span><span class=\"token operator\">:topBar</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:visible</span> <span class=\"token string\">\"true\"</span>\n                          <span class=\"token operator\">:title</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:text</span> <span class=\"token string\">\"My App\"</span><span class=\"token punctuation\">}</span>\n                          <span class=\"token operator\">:rightButtons</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:id</span> <span class=\"token string\">\"add\"</span> <span class=\"token operator\">:systemItem</span> <span class=\"token string\">\"add\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">-></span> <span class=\"token punctuation\">(</span>rnn/Navigation.events<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">(</span>.registerAppLaunchedListener\n       <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n         <span class=\"token punctuation\">(</span><span class=\"token keyword\">->></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:root</span>\n               <span class=\"token punctuation\">{</span><span class=\"token operator\">:stack</span>\n                <span class=\"token punctuation\">{</span><span class=\"token operator\">:children</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:component</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:name</span> <span class=\"token string\">\"App\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">(</span>clj->js<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">(</span>rnn/Navigation.setRoot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h1 id=\"credits\"><a href=\"#credits\" aria-label=\"credits permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Credits</h1>\n<p>That’s it! Done! Just four simple, easy, almost trivial steps! Well maybe not\nso trivial. I guess a ClojureScript beginner couldn’t have come up with this.\nWell, in fact I <em>am</em> a ClojureScript beginner and I <em>did not</em> come up with this\nsolution myself. All the credits go to <a href=\"https://github.com/thheller\">Thomas Heller</a>, the author of\n<a href=\"http://shadow-cljs.org\">shadow-cljs</a>. He has been amazing in his support by answering\nall of my beginner-level questions, and then he ended up conjuring this\nsolution and committing it to my repository. He actually spent hours on this\nI believe, and that level of support from a community is truly awesome\n(and rare). He doesn’t seem to be advertising it very much, but you can become\nhis <a href=\"https://www.patreon.com/thheller\">patreon</a>.</p>\n<h1 id=\"why-react-native-navigation\"><a href=\"#why-react-native-navigation\" aria-label=\"why react native navigation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why React Native Navigation</h1>\n<p>What’s special about React Native Navigation is that it is implemented using the\nreal platform native components, specifically\n<a href=\"https://developer.apple.com/documentation/uikit/uinavigationcontroller\"><code class=\"language-text\">UINavigationController</code></a> on\niOS. I seem to be at odds with most of the rest of the world on this, but I\nhappen to think that it is very important to present the user with an\nexperience that is (as much as possible) identical to that of native apps. You\nshouldn’t be able to tell from the user experience whether the app was written\nusing native technology or cross platform technology. Not even when you update\nyour OS to a new major version. So if my app uses a navigation stack, it has to\nbe the native one. Maybe I’m more sensitive to this then others, but I get\nreally upset by apps that don’t support the normal gesture for going back up the\nnavigation stack. I also get annoyed when the animation that is used while going\nback is slightly non-standard. Using the native components is the only way to\naccomplish that. Other components can come close, but not close enough for me.</p>\n<h3 id=\"versions\"><a href=\"#versions\" aria-label=\"versions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Versions</h3>\n<p>Like I said in the beginning, future versions of any of the tools may break\nthis guide. So it is only fair to mention which versions I was using for this:</p>\n<table>\n<thead>\n<tr>\n<th>Tool</th>\n<th>Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>node</td>\n<td>11.10.1</td>\n</tr>\n<tr>\n<td>npm</td>\n<td>6.5.0-next.0</td>\n</tr>\n<tr>\n<td>react</td>\n<td>16.8.3</td>\n</tr>\n<tr>\n<td>react-native</td>\n<td>0.59.3</td>\n</tr>\n<tr>\n<td>react-native-cli</td>\n<td>2.0.1</td>\n</tr>\n<tr>\n<td>react-native-navigation</td>\n<td>2.16.0</td>\n</tr>\n<tr>\n<td>shadow-cljs</td>\n<td>2.8.26</td>\n</tr>\n<tr>\n<td>Xcode</td>\n<td>10.2</td>\n</tr>\n<tr>\n<td>iOS SDK</td>\n<td>12.2</td>\n</tr>\n<tr>\n<td>Android SDK</td>\n<td>API levels 26, 27, 28</td>\n</tr>\n<tr>\n<td></td>\n<td>Build tools 27.0.3, 28.0.3</td>\n</tr>\n<tr>\n<td></td>\n<td>System images: android-28</td>\n</tr>\n</tbody>\n</table>","frontmatter":{"title":"React Native Navigation and ClojureScript","subtitle":"A beginner's guide to realizing proper navigation in a React Native application using ClojureScript and shadow-cljs","date":"2019-04-02","slug":"2019/04/02/react-native-navigation-and-clojurescript","language":null,"tags":["clojure","clojurescript","functional","react","react-native","shadow-cljs"],"authors":["stefan"],"comments":null,"cover":{"publicURL":"/static/background-a4a7d4ba06a7dbc7a26b196482b82095.jpg"},"coverLink":null,"coverDescription":null,"imageTw":{"publicURL":"/static/2019-04-02-react-native-navigation-and-clojurescript-tw-b31a8d3e2f965504587b4e29023d3a5a.png"},"imageFb":{"publicURL":"/static/2019-04-02-react-native-navigation-and-clojurescript-fb-2c58e4982617b79dc23038d31876c0b0.png"},"asciinema":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"2019/04/02/react-native-navigation-and-clojurescript","previous":{"frontmatter":{"title":"GraphQL + Spring Boot","slug":"2019/03/21/spring-boot-graphql","type":"post","tags":["graphql","spring","java"],"authors":["niek"]}},"next":{"frontmatter":{"title":"Cloud Run","slug":"2019/04/18/cloudrun","type":"post","tags":["cloud","google","docker"],"authors":["niek"]}}}}